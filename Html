<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema LittÃª v3.5</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- ConfiguraÃ§Ã£o de cores customizadas -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'litte-dark': '#284239',
            'litte-green': '#809076',
            'litte-cream': '#f8d794',
            'litte-orange': '#ba672f',
            'litte-black': '#182220',
          }
        }
      }
    }
  </script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      overflow-x: hidden;
    }
    
    /* Scrollbar customizada */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #809076;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #284239;
    }
    
    /* AnimaÃ§Ãµes suaves */
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    /* Modal backdrop */
    .modal-backdrop {
      background-color: rgba(40, 66, 57, 0.5);
    }
    
    /* Loading spinner */
    .spinner {
      border: 3px solid #f8d794;
      border-top: 3px solid #284239;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Sidebar hover */
    .sidebar-item:hover {
      background-color: rgba(128, 144, 118, 0.1);
      transform: translateX(4px);
      transition: all 0.2s ease;
    }
    
    .sidebar-item.active {
      background-color: #809076;
      color: white;
    }
    
    /* Tabela responsiva */
    .table-container {
      overflow-x: auto;
    }
    
    table {
      border-collapse: collapse;
      width: 100%;
    }
    
    th {
      position: sticky;
      top: 0;
      background-color: #284239;
      z-index: 10;
    }
    
    /* BotÃµes */
    .btn-primary {
      background-color: #284239;
      color: white;
      transition: all 0.2s;
    }
    
    .btn-primary:hover {
      background-color: #809076;
    }
    
    .btn-secondary {
      background-color: #809076;
      color: white;
      transition: all 0.2s;
    }
    
    .btn-secondary:hover {
      background-color: #284239;
    }
    
    /* Badges de status */
    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .badge-success { background-color: #809076; color: white; }
    .badge-warning { background-color: #f8d794; color: #284239; }
    .badge-danger { background-color: #ba672f; color: white; }
    .badge-info { background-color: #284239; color: white; }
  </style>
</head>

<body class="bg-gray-50">
  
  <!-- Layout Principal -->
  <div class="flex h-screen">
    
    <!-- SIDEBAR -->
    <aside id="sidebar" class="w-64 bg-litte-dark text-white flex flex-col shadow-lg">
      <!-- Logo/Header -->
      <div class="p-6 border-b border-litte-green">
        <h1 class="text-2xl font-bold">Sistema LittÃª</h1>
        <p class="text-sm text-litte-cream mt-1">v3.5</p>
      </div>
      
      <!-- Menu Navigation -->
      <nav class="flex-1 overflow-y-auto py-4">
        <a href="#" class="sidebar-item active flex items-center px-6 py-3 text-white" onclick="loadView('dashboard')">
          <span class="mr-3">ğŸ“Š</span>
          <span>Dashboard</span>
        </a>
        
        <a href="#" class="sidebar-item flex items-center px-6 py-3 text-white" onclick="loadView('assessorados')">
          <span class="mr-3">ğŸ‘¥</span>
          <span>Assessorados</span>
        </a>
        
        <a href="#" class="sidebar-item flex items-center px-6 py-3 text-white" onclick="loadView('prospeccoes')">
          <span class="mr-3">ğŸ¯</span>
          <span>ProspecÃ§Ãµes</span>
        </a>
        
        <a href="#" class="sidebar-item flex items-center px-6 py-3 text-white" onclick="loadView('campanhas')">
          <span class="mr-3">ğŸš€</span>
          <span>Campanhas Ativas</span>
        </a>
        
        <a href="#" class="sidebar-item flex items-center px-6 py-3 text-white" onclick="loadView('financeiro')">
          <span class="mr-3">ğŸ’°</span>
          <span>Financeiro</span>
        </a>
        
        <a href="#" class="sidebar-item flex items-center px-6 py-3 text-white" onclick="loadView('templates')">
          <span class="mr-3">ğŸ“</span>
          <span>Templates</span>
        </a>
        
        <a href="#" class="sidebar-item flex items-center px-6 py-3 text-white" onclick="loadView('notas')">
          <span class="mr-3">ğŸ“‹</span>
          <span>Notas</span>
        </a>
        
        <a href="#" class="sidebar-item flex items-center px-6 py-3 text-white" onclick="loadView('notificacoes')">
          <span class="mr-3">ğŸ””</span>
          <span>NotificaÃ§Ãµes</span>
          <span id="notif-badge" class="ml-auto bg-litte-orange text-white text-xs rounded-full px-2 py-1 hidden"></span>
        </a>
        
        <a href="#" class="sidebar-item flex items-center px-6 py-3 text-white" onclick="loadView('config')">
          <span class="mr-3">âš™ï¸</span>
          <span>ConfiguraÃ§Ãµes</span>
        </a>
      </nav>
      
      <!-- Footer Sidebar -->
      <div class="p-4 border-t border-litte-green text-sm text-litte-cream">
        <p>Ãšltima sync: <span id="last-sync">--</span></p>
      </div>
    </aside>
    
    <!-- CONTEÃšDO PRINCIPAL -->
    <main class="flex-1 overflow-hidden flex flex-col">
      
      <!-- Header da View -->
      <header id="view-header" class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
        <div class="flex items-center justify-between">
          <div>
            <h2 id="view-title" class="text-2xl font-bold text-litte-dark">Dashboard</h2>
            <p id="view-subtitle" class="text-sm text-gray-600 mt-1">VisÃ£o geral do sistema</p>
          </div>
          <div id="view-actions" class="flex gap-2">
            <!-- BotÃµes dinÃ¢micos por view -->
          </div>
        </div>
      </header>
      
      <!-- ConteÃºdo da View -->
      <div id="view-content" class="flex-1 overflow-y-auto p-6 bg-gray-50">
        <!-- ConteÃºdo carregado dinamicamente -->
      </div>
      
    </main>
    
  </div>
  
  <!-- MODAIS (Todos os modais do sistema) -->
  <div id="modals-container"></div>
  
  <!-- Loading Global Overlay -->
  <div id="loading-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 flex items-center gap-4">
      <div class="spinner"></div>
      <span id="loading-text" class="text-litte-dark font-medium">Carregando...</span>
    </div>
  </div>
  
  <!-- Toast de NotificaÃ§Ãµes -->
  <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

  <!-- JAVASCRIPT -->
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //                    VARIÃVEIS GLOBAIS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    let currentView = 'dashboard';
    let cachedData = {
      assessorados: null,
      prospeccoes: null,
      campanhas: null,
      financeiro: null,
      notificacoes: null
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //                    UTILITÃRIOS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function showLoading(text = 'Carregando...') {
      document.getElementById('loading-text').textContent = text;
      document.getElementById('loading-overlay').classList.remove('hidden');
    }
    
    function hideLoading() {
      document.getElementById('loading-overlay').classList.add('hidden');
    }
    
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `fade-in p-4 rounded-lg shadow-lg ${
        type === 'success' ? 'bg-litte-green' : 
        type === 'error' ? 'bg-litte-orange' : 
        'bg-litte-dark'
      } text-white`;
      toast.textContent = message;
      
      document.getElementById('toast-container').appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }
    
    function formatCurrency(value) {
      return new Intl.NumberFormat('pt-BR', {
        style: 'currency',
        currency: 'BRL'
      }).format(value);
    }
    
    function formatDate(dateString) {
      if (!dateString) return '--';
      const date = new Date(dateString);
      return date.toLocaleDateString('pt-BR');
    }
    
    function updateLastSync() {
      const now = new Date();
      document.getElementById('last-sync').textContent = now.toLocaleTimeString('pt-BR');
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //                    NAVEGAÃ‡ÃƒO E VIEWS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function loadView(viewName) {
      currentView = viewName;
      
      // Atualizar sidebar ativa
      document.querySelectorAll('.sidebar-item').forEach(item => {
        item.classList.remove('active');
      });
      event.target.closest('.sidebar-item').classList.add('active');
      
      // Carregar view
      switch(viewName) {
        case 'dashboard':
          renderDashboard();
          break;
        case 'assessorados':
          renderAssessorados();
          break;
        case 'prospeccoes':
          renderProspeccoes();
          break;
        case 'campanhas':
          renderCampanhas();
          break;
        case 'financeiro':
          renderFinanceiro();
          break;
        case 'templates':
          renderTemplates();
          break;
        case 'notas':
          renderNotas();
          break;
        case 'notificacoes':
          renderNotificacoes();
          break;
        case 'config':
          renderConfig();
          break;
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //                    VIEW: DASHBOARD
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //                    VIEW: DASHBOARD (VERSÃƒO COMPLETA)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function renderDashboard() {
      document.getElementById('view-title').textContent = 'Dashboard';
      document.getElementById('view-subtitle').textContent = 'VisÃ£o geral do sistema';
      
      document.getElementById('view-actions').innerHTML = `
        <button onclick="refreshDashboard()" class="btn-secondary px-4 py-2 rounded-lg flex items-center gap-2">
          <span>ğŸ”„</span>
          <span>Atualizar</span>
        </button>
      `;
      
      showLoading('Carregando dashboard...');
      
      // Carregar dados do dashboard
      google.script.run
        .withSuccessHandler(function(dashboardData) {
          hideLoading();
          renderDashboardCards(dashboardData);
          
          // Carregar atividades recentes
          carregarUltimasAtividades();
          
          // Carregar prÃ³ximos prazos
          carregarProximosPrazos();
          
          updateLastSync();
        })
        .withFailureHandler(function(error) {
          hideLoading();
          showToast('Erro ao carregar dashboard', 'error');
          console.error(error);
        })
        .getDashboardData();
    }
    
    function renderDashboardCards(data) {
      const html = `
        <!-- Cards Principais -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
          
          <!-- Card: Total Assessorados -->
          <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-lg p-6 text-white hover:shadow-xl transition transform hover:scale-105">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-blue-100 mb-1">Total Assessorados</p>
                <p class="text-4xl font-bold">${data.totalAssessorados || 0}</p>
                <p class="text-xs text-blue-100 mt-2">Cadastrados no sistema</p>
              </div>
              <div class="text-6xl opacity-20">ğŸ‘¥</div>
            </div>
          </div>
          
          <!-- Card: Campanhas Ativas -->
          <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-lg p-6 text-white hover:shadow-xl transition transform hover:scale-105">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-green-100 mb-1">Campanhas Ativas</p>
                <p class="text-4xl font-bold">${data.campanhasAtivas || 0}</p>
                <p class="text-xs text-green-100 mt-2">Em andamento</p>
              </div>
              <div class="text-6xl opacity-20">ğŸš€</div>
            </div>
          </div>
          
          <!-- Card: Faturamento MÃªs -->
          <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg shadow-lg p-6 text-white hover:shadow-xl transition transform hover:scale-105">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-purple-100 mb-1">Faturamento MÃªs</p>
                <p class="text-3xl font-bold">${formatCurrency(data.faturamentoMes || 0)}</p>
                <p class="text-xs text-purple-100 mt-2">MÃªs atual</p>
              </div>
              <div class="text-6xl opacity-20">ğŸ’°</div>
            </div>
          </div>
          
          <!-- Card: Taxa ConversÃ£o -->
          <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg shadow-lg p-6 text-white hover:shadow-xl transition transform hover:scale-105">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-orange-100 mb-1">Taxa de ConversÃ£o</p>
                <p class="text-4xl font-bold">${data.taxaConversao || 0}%</p>
                <p class="text-xs text-orange-100 mt-2">ProspecÃ§Ãµes fechadas</p>
              </div>
              <div class="text-6xl opacity-20">ğŸ“ˆ</div>
            </div>
          </div>
          
        </div>
        
        <!-- Cards SecundÃ¡rios -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
          
          <!-- ProspecÃ§Ãµes em Andamento -->
          <div class="bg-white border-2 border-yellow-400 rounded-lg shadow p-5 hover:shadow-lg transition">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center text-2xl">
                ğŸ¯
              </div>
              <div>
                <p class="text-sm text-gray-600">ProspecÃ§Ãµes</p>
                <p class="text-2xl font-bold text-yellow-600">${data.prospeccoes || 0}</p>
              </div>
            </div>
            <div class="text-xs text-gray-500">Em negociaÃ§Ã£o</div>
          </div>
          
          <!-- PendÃªncias -->
          <div class="bg-white border-2 border-red-400 rounded-lg shadow p-5 hover:shadow-lg transition">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-2xl">
                âš ï¸
              </div>
              <div>
                <p class="text-sm text-gray-600">PendÃªncias</p>
                <p class="text-2xl font-bold text-red-600">${data.pendencias || 0}</p>
              </div>
            </div>
            <div class="text-xs text-gray-500">Aguardando aÃ§Ã£o</div>
          </div>
          
          <!-- NFs Pendentes -->
          <div class="bg-white border-2 border-indigo-400 rounded-lg shadow p-5 hover:shadow-lg transition">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center text-2xl">
                ğŸ“„
              </div>
              <div>
                <p class="text-sm text-gray-600">NFs Pendentes</p>
                <p class="text-2xl font-bold text-indigo-600">${data.nfsPendentes || 0}</p>
              </div>
            </div>
            <div class="text-xs text-gray-500">A serem emitidas</div>
          </div>
          
        </div>
        
        <!-- SeÃ§Ã£o de Atividades e Prazos -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          
          <!-- Ãšltimas Atividades -->
          <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="bg-gradient-to-r from-litte-dark to-litte-green text-white px-6 py-4 flex items-center justify-between">
              <h3 class="text-lg font-bold flex items-center gap-2">
                <span>ğŸ“‹</span>
                <span>Ãšltimas Atividades</span>
              </h3>
              <button onclick="renderHistorico()" class="text-sm hover:text-litte-cream transition">Ver todas â†’</button>
            </div>
            <div id="ultimas-atividades" class="p-6">
              <div class="flex items-center justify-center py-8">
                <div class="spinner"></div>
              </div>
            </div>
          </div>
          
          <!-- PrÃ³ximos Prazos -->
          <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-4 flex items-center justify-between">
              <h3 class="text-lg font-bold flex items-center gap-2">
                <span>â°</span>
                <span>PrÃ³ximos Prazos</span>
              </h3>
              <button onclick="renderCampanhasAtivas()" class="text-sm hover:text-orange-100 transition">Ver todas â†’</button>
            </div>
            <div id="proximos-prazos" class="p-6">
              <div class="flex items-center justify-center py-8">
                <div class="spinner"></div>
              </div>
            </div>
          </div>
          
        </div>
      `;
      
      document.getElementById('view-content').innerHTML = html;
    }
    
    function carregarUltimasAtividades() {
      google.script.run
        .withSuccessHandler(function(atividades) {
          renderUltimasAtividades(atividades);
        })
        .withFailureHandler(function(error) {
          document.getElementById('ultimas-atividades').innerHTML = `
            <p class="text-sm text-red-500">âŒ Erro ao carregar atividades</p>
          `;
          console.error(error);
        })
        .getUltimasAtividades(10); // Pega Ãºltimas 10
    }
    
    function renderUltimasAtividades(atividades) {
      if (!atividades || atividades.length === 0) {
        document.getElementById('ultimas-atividades').innerHTML = `
          <div class="text-center py-8">
            <span class="text-4xl mb-2 block">ğŸ“­</span>
            <p class="text-gray-500">Nenhuma atividade recente</p>
          </div>
        `;
        return;
      }
      
      const html = `
        <div class="space-y-3 max-h-96 overflow-y-auto">
          ${atividades.map(function(ativ) {
            const icone = getIconeAtividade(ativ.tipo);
            const cor = getCorAtividade(ativ.tipo);
            
            return `
              <div class="flex items-start gap-3 p-3 hover:bg-gray-50 rounded-lg transition">
                <div class="w-10 h-10 ${cor} rounded-full flex items-center justify-center flex-shrink-0">
                  ${icone}
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-medium text-gray-900 truncate">
                    ${ativ.acao || 'Atividade'}
                  </p>
                  <p class="text-xs text-gray-600 mt-1">
                    ${ativ.tipo || ''} ${ativ.idCampanha ? '- ' + ativ.idCampanha : ''}
                  </p>
                  <p class="text-xs text-gray-400 mt-1">
                    ${ativ.dataHora ? formatDataHora(ativ.dataHora) : ''} ${ativ.usuario ? 'â€¢ ' + ativ.usuario : ''}
                  </p>
                </div>
              </div>
            `;
          }).join('')}
        </div>
      `;
      
      document.getElementById('ultimas-atividades').innerHTML = html;
    }
    
    function carregarProximosPrazos() {
      google.script.run
        .withSuccessHandler(function(prazos) {
          renderProximosPrazos(prazos);
        })
        .withFailureHandler(function(error) {
          document.getElementById('proximos-prazos').innerHTML = `
            <p class="text-sm text-red-500">âŒ Erro ao carregar prazos</p>
          `;
          console.error(error);
        })
        .getProximosPrazos(10); // Pega prÃ³ximos 10 prazos
    }
    
    function renderProximosPrazos(prazos) {
      if (!prazos || prazos.length === 0) {
        document.getElementById('proximos-prazos').innerHTML = `
          <div class="text-center py-8">
            <span class="text-4xl mb-2 block">âœ…</span>
            <p class="text-gray-500">Nenhum prazo prÃ³ximo</p>
          </div>
        `;
        return;
      }
      
      const hoje = new Date();
      hoje.setHours(0, 0, 0, 0);
      
      const html = `
        <div class="space-y-3 max-h-96 overflow-y-auto">
          ${prazos.map(function(prazo) {
            const dataPrazo = new Date(prazo.dataPrevista);
            dataPrazo.setHours(0, 0, 0, 0);
            
            const diasRestantes = Math.ceil((dataPrazo - hoje) / (1000 * 60 * 60 * 24));
            
            let badge = '';
            let corBadge = '';
            
            if (diasRestantes < 0) {
              badge = 'ATRASADO';
              corBadge = 'bg-red-100 text-red-800';
            } else if (diasRestantes === 0) {
              badge = 'HOJE';
              corBadge = 'bg-orange-100 text-orange-800';
            } else if (diasRestantes === 1) {
              badge = 'AMANHÃƒ';
              corBadge = 'bg-yellow-100 text-yellow-800';
            } else if (diasRestantes <= 3) {
              badge = diasRestantes + ' DIAS';
              corBadge = 'bg-yellow-100 text-yellow-800';
            } else {
              badge = diasRestantes + ' DIAS';
              corBadge = 'bg-blue-100 text-blue-800';
            }
            
            return `
              <div class="flex items-start gap-3 p-3 hover:bg-gray-50 rounded-lg transition border-l-4 ${
                diasRestantes < 0 ? 'border-red-500' : 
                diasRestantes === 0 ? 'border-orange-500' : 
                diasRestantes <= 3 ? 'border-yellow-500' : 
                'border-blue-500'
              }">
                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2 mb-1">
                    <span class="px-2 py-1 rounded text-xs font-bold ${corBadge}">
                      ${badge}
                    </span>
                    <span class="text-xs text-gray-500">
                      ${formatData(prazo.dataPrevista)}
                    </span>
                  </div>
                  <p class="text-sm font-medium text-gray-900 truncate">
                    ${prazo.etapa || 'Etapa'}
                  </p>
                  <p class="text-xs text-gray-600 mt-1">
                    ${prazo.idCampanha || ''} ${prazo.marca ? '- ' + prazo.marca : ''}
                  </p>
                </div>
                <button onclick="verDetalhesCampanha('${prazo.idCampanha}')" 
                  class="text-litte-dark hover:text-litte-green transition flex-shrink-0">
                  ğŸ‘ï¸
                </button>
              </div>
            `;
          }).join('')}
        </div>
      `;
      
      document.getElementById('proximos-prazos').innerHTML = html;
    }
    
    function getIconeAtividade(tipo) {
      const icones = {
        'Assessorado': 'ğŸ‘¤',
        'Andamento': 'ğŸ“',
        'Campanha': 'ğŸ¬',
        'Checklist': 'âœ…',
        'Financeiro': 'ğŸ’°',
        'Status': 'ğŸ“Š',
        'Drive': 'ğŸ“',
        'AutomaÃ§Ã£o': 'ğŸ¤–',
        'Nota': 'ğŸ“Œ'
      };
      return icones[tipo] || 'ğŸ“‹';
    }
    
    function getCorAtividade(tipo) {
      const cores = {
        'Assessorado': 'bg-blue-100 text-blue-600',
        'Andamento': 'bg-purple-100 text-purple-600',
        'Campanha': 'bg-green-100 text-green-600',
        'Checklist': 'bg-yellow-100 text-yellow-600',
        'Financeiro': 'bg-emerald-100 text-emerald-600',
        'Status': 'bg-indigo-100 text-indigo-600',
        'Drive': 'bg-orange-100 text-orange-600',
        'AutomaÃ§Ã£o': 'bg-pink-100 text-pink-600',
        'Nota': 'bg-gray-100 text-gray-600'
      };
      return cores[tipo] || 'bg-gray-100 text-gray-600';
    }
    
    function formatDataHora(dataHora) {
      if (!dataHora) return '';
      const data = new Date(dataHora);
      const hoje = new Date();
      const ontem = new Date(hoje);
      ontem.setDate(ontem.getDate() - 1);
      
      if (data.toDateString() === hoje.toDateString()) {
        return 'Hoje Ã s ' + data.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
      } else if (data.toDateString() === ontem.toDateString()) {
        return 'Ontem Ã s ' + data.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
      } else {
        return data.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }) + 
               ' Ã s ' + data.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
      }
    }
    
    function formatData(data) {
      if (!data) return '';
      const d = new Date(data);
      return d.toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' });
    }
    
    function verDetalhesCampanha(idCampanha) {
      // Redirecionar para campanhas e abrir detalhes
      renderCampanhasAtivas();
      setTimeout(function() {
        verDetalhesChecklist(idCampanha);
      }, 500);
    }
    
    function refreshDashboard() {
      renderDashboard();
    }
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //                    VIEW: ASSESSORADOS (VERSÃƒO COMPLETA)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function renderAssessorados() {
      document.getElementById('view-title').textContent = 'Assessorados';
      document.getElementById('view-subtitle').textContent = 'Gerenciar influenciadores';
      
      document.getElementById('view-actions').innerHTML = `
        <button onclick="openModalNovoAssessorado()" class="btn-primary px-4 py-2 rounded-lg flex items-center gap-2">
          <span>â•</span>
          <span>Novo Assessorado</span>
        </button>
        <button onclick="refreshAssessorados()" class="btn-secondary px-4 py-2 rounded-lg flex items-center gap-2">
          <span>ğŸ”„</span>
          <span>Atualizar</span>
        </button>
      `;
      
      // Mostrar loading na tabela enquanto carrega
      document.getElementById('view-content').innerHTML = `
        <div class="bg-white rounded-lg shadow p-8 text-center">
          <div class="spinner mx-auto mb-4"></div>
          <p class="text-gray-600">Carregando assessorados...</p>
        </div>
      `;
      
      google.script.run
        .withSuccessHandler(function(assessorados) {
          cachedData.assessorados = assessorados;
          renderTabelaAssessorados(assessorados);
          updateLastSync();
        })
        .withFailureHandler(function(error) {
          document.getElementById('view-content').innerHTML = `
            <div class="bg-white rounded-lg shadow p-8 text-center">
              <p class="text-red-500 mb-4">âŒ Erro ao carregar assessorados</p>
              <button onclick="refreshAssessorados()" class="btn-primary px-4 py-2 rounded-lg">
                Tentar novamente
              </button>
            </div>
          `;
          showToast('Erro ao carregar assessorados', 'error');
          console.error(error);
        })
        .getAllAssessorados();
    }
    
    function renderTabelaAssessorados(assessorados) {
      console.log('ğŸ“Š Renderizando tabela com', assessorados.length, 'assessorados');
      
      // Cards de resumo
      const totalAtivos = assessorados.filter(a => a.status === 'Ativo').length;
      const totalInativos = assessorados.length - totalAtivos;
      const totalMes = getAssessoradosDoMes(assessorados);
      
      let html = `
        <!-- Cards de Resumo -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
          <div class="bg-white border-2 border-litte-dark rounded-lg p-4 hover:shadow-lg transition">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-600 mb-1">Total</p>
                <p class="text-3xl font-bold text-litte-dark">${assessorados.length}</p>
              </div>
              <div class="w-12 h-12 bg-litte-dark rounded-full flex items-center justify-center text-white text-2xl">
                ğŸ‘¥
              </div>
            </div>
          </div>
          
          <div class="bg-white border-2 border-green-500 rounded-lg p-4 hover:shadow-lg transition">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-600 mb-1">Ativos</p>
                <p class="text-3xl font-bold text-green-600">${totalAtivos}</p>
              </div>
              <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white text-2xl">
                âœ…
              </div>
            </div>
          </div>
          
          <div class="bg-white border-2 border-red-500 rounded-lg p-4 hover:shadow-lg transition">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-600 mb-1">Inativos</p>
                <p class="text-3xl font-bold text-red-600">${totalInativos}</p>
              </div>
              <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center text-white text-2xl">
                âŒ
              </div>
            </div>
          </div>
          
          <div class="bg-white border-2 border-litte-green rounded-lg p-4 hover:shadow-lg transition">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-600 mb-1">Este MÃªs</p>
                <p class="text-3xl font-bold text-litte-green">${totalMes}</p>
              </div>
              <div class="w-12 h-12 bg-litte-green rounded-full flex items-center justify-center text-white text-2xl">
                ğŸ“…
              </div>
            </div>
          </div>
        </div>
        
        <!-- Tabela -->
        <div class="bg-white rounded-lg shadow">
          <div class="table-container">
            <table class="w-full">
              <thead>
                <tr class="border-b border-gray-200">
                  <th class="text-left px-6 py-3 text-sm font-semibold text-white">ID</th>
                  <th class="text-left px-6 py-3 text-sm font-semibold text-white">Nome</th>
                  <th class="text-left px-6 py-3 text-sm font-semibold text-white">UsuÃ¡rio</th>
                  <th class="text-left px-6 py-3 text-sm font-semibold text-white">Email</th>
                  <th class="text-left px-6 py-3 text-sm font-semibold text-white">Telefone</th>
                  <th class="text-left px-6 py-3 text-sm font-semibold text-white">Status</th>
                  <th class="text-left px-6 py-3 text-sm font-semibold text-white">Drive</th>
                  <th class="text-center px-6 py-3 text-sm font-semibold text-white">AÃ§Ãµes</th>
                </tr>
              </thead>
              <tbody>
      `;
      
      if (assessorados.length === 0) {
        html += `
          <tr>
            <td colspan="8" class="px-6 py-12 text-center text-gray-500">
              <div class="flex flex-col items-center gap-4">
                <span class="text-6xl">ğŸ‘¤</span>
                <p class="text-lg font-medium">Nenhum assessorado cadastrado</p>
                <button onclick="openModalNovoAssessorado()" class="btn-primary px-6 py-3 rounded-lg">
                  â• Cadastrar Primeiro Assessorado
                </button>
              </div>
            </td>
          </tr>
        `;
      } else {
        assessorados.forEach(function(a) {
          html += `
            <tr class="border-b border-gray-100 hover:bg-gray-50 transition">
              <td class="px-6 py-4">
                <span class="font-mono font-bold text-litte-dark">${a.id || '--'}</span>
              </td>
              <td class="px-6 py-4">
                <div class="flex items-center gap-2">
                  <div class="w-8 h-8 bg-litte-dark rounded-full flex items-center justify-center text-white font-bold text-sm">
                    ${a.nome ? a.nome.charAt(0).toUpperCase() : '?'}
                  </div>
                  <span class="font-medium">${a.nome || '--'}</span>
                </div>
              </td>
              <td class="px-6 py-4">
                <span class="text-gray-600">@${a.usuario || '--'}</span>
              </td>
              <td class="px-6 py-4">
                <span class="text-sm">${a.email || '--'}</span>
              </td>
              <td class="px-6 py-4">
                <span class="text-sm">${a.telefone || '--'}</span>
              </td>
              <td class="px-6 py-4">
                <span class="px-2 py-1 rounded-full text-xs font-medium ${
                  a.status === 'Ativo' 
                    ? 'bg-green-100 text-green-800' 
                    : 'bg-red-100 text-red-800'
                }">
                  ${a.status === 'Ativo' ? 'âœ…' : 'âŒ'} ${a.status || 'Ativo'}
                </span>
              </td>
              <td class="px-6 py-4">
                ${a.urlPastaDrive ? `
                  <a href="${a.urlPastaDrive}" target="_blank" 
                    class="text-litte-dark hover:text-litte-green transition flex items-center gap-1">
                    <span>ğŸ“</span>
                    <span class="text-sm">Abrir</span>
                  </a>
                ` : `
                  <span class="text-xs text-gray-400">Sem pasta</span>
                `}
              </td>
              <td class="px-6 py-4">
                <div class="flex items-center justify-center gap-1">
                  <button onclick="verDetalhesAssessorado('${a.id}')" 
                    class="p-2 hover:bg-blue-50 rounded transition" title="Ver detalhes">
                    ğŸ‘ï¸
                  </button>
                  <button onclick='editarAssessorado("${a.id}")' 
                    class="p-2 hover:bg-yellow-50 rounded transition" title="Editar">
                    âœï¸
                  </button>
                  ${a.urlPastaDrive ? `
                    <a href="${a.urlPastaDrive}" target="_blank"
                      class="p-2 hover:bg-green-50 rounded transition" title="Pasta Drive">
                      ğŸ“
                    </a>
                  ` : ''}
                  ${a.linkPlanilhaEspelho ? `
                    <a href="${a.linkPlanilhaEspelho}" target="_blank"
                      class="p-2 hover:bg-purple-50 rounded transition" title="Planilha Espelho">
                      ğŸ“Š
                    </a>
                  ` : ''}
                </div>
              </td>
            </tr>
          `;
        });
      }
      
      html += `
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      document.getElementById('view-content').innerHTML = html;
      console.log('âœ… Tabela renderizada com sucesso');
    }
    
    function getAssessoradosDoMes(assessorados) {
      const hoje = new Date();
      const mesAtual = hoje.getMonth();
      const anoAtual = hoje.getFullYear();
      
      return assessorados.filter(function(a) {
        if (!a.dataCadastro) return false;
        const data = new Date(a.dataCadastro);
        return data.getMonth() === mesAtual && data.getFullYear() === anoAtual;
      }).length;
    }
    
    function refreshAssessorados() {
      renderAssessorados();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //                    MODAL: NOVO ASSESSORADO (COMPLETO)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function openModalNovoAssessorado() {
      const modalHTML = `
        <div id="modal-novo-assessorado" class="fixed inset-0 modal-backdrop flex items-center justify-center z-40 fade-in">
          <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto m-4">
            
            <!-- Header -->
            <div class="bg-gradient-to-r from-litte-dark to-litte-green text-white px-6 py-4 flex items-center justify-between sticky top-0 z-10 shadow-lg">
              <div>
                <h3 class="text-xl font-bold">â• Novo Assessorado</h3>
                <p class="text-sm text-litte-cream">Cadastre um novo influenciador</p>
              </div>
              <button onclick="closeModal('modal-novo-assessorado')" class="text-2xl hover:text-litte-cream hover:rotate-90 transition-transform">&times;</button>
            </div>
            
            <!-- Body -->
            <div class="p-6">
              <form id="form-novo-assessorado" onsubmit="salvarNovoAssessorado(event)">
                
                <!-- InformaÃ§Ãµes BÃ¡sicas -->
                <div class="mb-6">
                  <h4 class="text-lg font-bold text-litte-dark mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2">
                    <span>ğŸ‘¤</span>
                    <span>InformaÃ§Ãµes BÃ¡sicas</span>
                  </h4>
                  
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-litte-dark mb-2">Nome Completo *</label>
                      <input type="text" name="nome" required 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                        placeholder="Ex: Maria Silva">
                    </div>
                    
                    <div>
                      <label class="block text-sm font-medium text-litte-dark mb-2">UsuÃ¡rio (Instagram/TikTok) *</label>
                      <div class="flex items-center">
                        <span class="px-3 py-2 bg-gray-100 border border-r-0 border-gray-300 rounded-l-lg text-gray-600">@</span>
                        <input type="text" name="usuario" required 
                          class="flex-1 px-4 py-2 border border-gray-300 rounded-r-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                          placeholder="usuario_influencer">
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Contato -->
                <div class="mb-6">
                  <h4 class="text-lg font-bold text-litte-dark mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2">
                    <span>ğŸ“§</span>
                    <span>InformaÃ§Ãµes de Contato</span>
                  </h4>
                  
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-litte-dark mb-2">Email</label>
                      <input type="email" name="email" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                        placeholder="email@exemplo.com">
                    </div>
                    
                    <div>
                      <label class="block text-sm font-medium text-litte-dark mb-2">Telefone</label>
                      <input type="tel" name="telefone" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                        placeholder="(00) 00000-0000">
                    </div>
                    
                    <div>
                      <label class="block text-sm font-medium text-litte-dark mb-2">Idade</label>
                      <input type="number" name="idade" min="1" max="120"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                        placeholder="25">
                    </div>
                  </div>
                </div>
                
                <!-- Medidas e Tamanhos -->
                <div class="mb-6">
                  <h4 class="text-lg font-bold text-litte-dark mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2">
                    <span>ğŸ‘•</span>
                    <span>Medidas e Tamanhos</span>
                  </h4>
                  
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-litte-dark mb-2">Camiseta</label>
                      <select name="camiseta" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent">
                        <option value="">Selecione...</option>
                        <option value="PP">PP</option>
                        <option value="P">P</option>
                        <option value="M">M</option>
                        <option value="G">G</option>
                        <option value="GG">GG</option>
                        <option value="XG">XG</option>
                      </select>
                    </div>
                    
                    <div>
                      <label class="block text-sm font-medium text-litte-dark mb-2">CalÃ§a</label>
                      <input type="text" name="calca" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                        placeholder="Ex: 38, 40, 42">
                    </div>
                    
                    <div>
                      <label class="block text-sm font-medium text-litte-dark mb-2">Sapato</label>
                      <select name="sapato" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent">
                        <option value="">Selecione...</option>
                        ${[33,34,35,36,37,38,39,40,41,42,43,44].map(function(n) { return '<option value="'+n+'">'+n+'</option>'; }).join('')}
                      </select>
                    </div>
                  </div>
                </div>
                
                <!-- EndereÃ§o Completo -->
                <div class="mb-6">
                  <h4 class="text-lg font-bold text-litte-dark mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2">
                    <span>ğŸ“</span>
                    <span>EndereÃ§o de Entrega</span>
                  </h4>
                  
                  <div class="space-y-4">
                    <div>
                      <label class="block text-sm font-medium text-litte-dark mb-2">Nome do DestinatÃ¡rio</label>
                      <input type="text" name="enderecoNome" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                        placeholder="Ex: Maria Silva ou Nome da Empresa">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-litte-dark mb-2">Rua/Avenida</label>
                        <input type="text" name="rua" 
                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                          placeholder="Ex: Rua das Flores">
                      </div>
                      
                      <div>
                        <label class="block text-sm font-medium text-litte-dark mb-2">NÃºmero</label>
                        <input type="text" name="numero" 
                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                          placeholder="123">
                      </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-litte-dark mb-2">Complemento</label>
                        <input type="text" name="complemento" 
                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                          placeholder="Ex: Apto 101, Bloco B">
                      </div>
                      
                      <div>
                        <label class="block text-sm font-medium text-litte-dark mb-2">Bairro</label>
                        <input type="text" name="bairro" 
                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                          placeholder="Ex: Centro">
                      </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-litte-dark mb-2">Cidade</label>
                        <input type="text" name="cidade" 
                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                          placeholder="Ex: SÃ£o Paulo">
                      </div>
                      
                      <div>
                        <label class="block text-sm font-medium text-litte-dark mb-2">Estado</label>
                        <select name="estado" 
                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent">
                          <option value="">Selecione...</option>
                          <option value="AC">AC</option><option value="AL">AL</option><option value="AP">AP</option>
                          <option value="AM">AM</option><option value="BA">BA</option><option value="CE">CE</option>
                          <option value="DF">DF</option><option value="ES">ES</option><option value="GO">GO</option>
                          <option value="MA">MA</option><option value="MT">MT</option><option value="MS">MS</option>
                          <option value="MG">MG</option><option value="PA">PA</option><option value="PB">PB</option>
                          <option value="PR">PR</option><option value="PE">PE</option><option value="PI">PI</option>
                          <option value="RJ">RJ</option><option value="RN">RN</option><option value="RS">RS</option>
                          <option value="RO">RO</option><option value="RR">RR</option><option value="SC">SC</option>
                          <option value="SP">SP</option><option value="SE">SE</option><option value="TO">TO</option>
                        </select>
                      </div>
                      
                      <div>
                        <label class="block text-sm font-medium text-litte-dark mb-2">CEP</label>
                        <input type="text" name="cep" 
                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                          placeholder="00000-000">
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- ObservaÃ§Ãµes -->
                <div class="mb-6">
                  <h4 class="text-lg font-bold text-litte-dark mb-4 flex items-center gap-2 border-b-2 border-litte-dark pb-2">
                    <span>ğŸ“</span>
                    <span>ObservaÃ§Ãµes</span>
                  </h4>
                  
                  <textarea name="observacoes" rows="4"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                    placeholder="ObservaÃ§Ãµes gerais sobre o assessorado..."></textarea>
                </div>
                
                <!-- Status -->
                <div class="mb-6">
                  <label class="block text-sm font-medium text-litte-dark mb-2">Status</label>
                  <select name="status" 
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent">
                    <option value="Ativo">âœ… Ativo</option>
                    <option value="Inativo">âŒ Inativo</option>
                  </select>
                </div>
                
                <!-- Info AutomÃ¡tica -->
                <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-6">
                  <h5 class="font-bold text-blue-900 mb-2 flex items-center gap-2">
                    <span>ğŸ¤–</span>
                    <span>AutomaÃ§Ãµes que serÃ£o executadas:</span>
                  </h5>
                  <ul class="text-sm text-blue-800 space-y-1 ml-6">
                    <li>âœ… GeraÃ§Ã£o automÃ¡tica de ID Ãºnico</li>
                    <li>âœ… CriaÃ§Ã£o de pasta no Google Drive com 5 subpastas organizadas</li>
                    <li>âœ… CriaÃ§Ã£o de planilha espelho para acompanhamento</li>
                    <li>âœ… Registro no histÃ³rico do sistema</li>
                    <li>âœ… NotificaÃ§Ã£o para toda equipe</li>
                  </ul>
                </div>
                
                <!-- BotÃµes -->
                <div class="flex gap-2 justify-end pt-4 border-t-2 border-gray-200">
                  <button type="button" onclick="closeModal('modal-novo-assessorado')" 
                    class="px-6 py-2 border-2 border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition">
                    Cancelar
                  </button>
                  <button type="submit" 
                    class="btn-primary px-6 py-2 rounded-lg flex items-center gap-2 font-medium">
                    <span id="btn-save-spinner" class="hidden">
                      <div class="spinner"></div>
                    </span>
                    <span id="btn-save-text">ğŸ’¾ Salvar e Criar Estrutura</span>
                  </button>
                </div>
                
              </form>
            </div>
            
          </div>
        </div>
      `;
      
      document.getElementById('modals-container').innerHTML = modalHTML;
    }
    
    function salvarNovoAssessorado(event) {
      event.preventDefault();
      
      const form = event.target;
      const formData = new FormData(form);
      
      const dados = {
        nome: formData.get('nome'),
        usuario: formData.get('usuario'),
        email: formData.get('email') || '',
        telefone: formData.get('telefone') || '',
        idade: formData.get('idade') || '',
        sapato: formData.get('sapato') || '',
        camiseta: formData.get('camiseta') || '',
        calca: formData.get('calca') || '',
        enderecoNome: formData.get('enderecoNome') || '',
        rua: formData.get('rua') || '',
        numero: formData.get('numero') || '',
        complemento: formData.get('complemento') || '',
        bairro: formData.get('bairro') || '',
        cidade: formData.get('cidade') || '',
        estado: formData.get('estado') || '',
        cep: formData.get('cep') || '',
        observacoes: formData.get('observacoes') || '',
        status: formData.get('status') || 'Ativo'
      };
      
      // Mostrar loading no botÃ£o
      document.getElementById('btn-save-spinner').classList.remove('hidden');
      document.getElementById('btn-save-text').textContent = 'Criando estrutura...';
      form.querySelectorAll('button').forEach(function(btn) { btn.disabled = true; });
      
      console.log('ğŸ’¾ Criando assessorado:', dados);
      
      google.script.run
        .withSuccessHandler(function(result) {
          form.querySelectorAll('button').forEach(function(btn) { btn.disabled = false; });
          document.getElementById('btn-save-spinner').classList.add('hidden');
          document.getElementById('btn-save-text').textContent = 'ğŸ’¾ Salvar e Criar Estrutura';
          
          if (result.success) {
            closeModal('modal-novo-assessorado');
            
            // Mensagem de sucesso detalhada
            let mensagem = 'âœ… Assessorado criado com sucesso!';
            if (result.urlPastaDrive) {
              mensagem += '\nğŸ“ Pasta Drive criada';
            }
            if (result.urlPlanilhaEspelho) {
              mensagem += '\nğŸ“Š Planilha espelho criada';
            }
            
            showToast(mensagem, 'success');
            
            // Limpar cache e recarregar
            cachedData.assessorados = null;
            
            setTimeout(function() {
              renderAssessorados();
            }, 500);
          } else {
            showToast('âŒ Erro: ' + result.message, 'error');
          }
        })
        .withFailureHandler(function(error) {
          form.querySelectorAll('button').forEach(function(btn) { btn.disabled = false; });
          document.getElementById('btn-save-spinner').classList.add('hidden');
          document.getElementById('btn-save-text').textContent = 'ğŸ’¾ Salvar e Criar Estrutura';
          showToast('âŒ Erro ao criar assessorado', 'error');
          console.error(error);
        })
        .criarAssessorado(dados);
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //                    MODAL: EDITAR ASSESSORADO
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function editarAssessorado(id) {
      console.log('âœï¸ Editando assessorado:', id);
      
      showLoading('Carregando dados...');
      
      google.script.run
        .withSuccessHandler(function(assessorado) {
          hideLoading();
          
          if (assessorado) {
            renderModalEditarAssessorado(assessorado);
          } else {
            showToast('âŒ Assessorado nÃ£o encontrado', 'error');
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          showToast('âŒ Erro ao carregar dados', 'error');
          console.error(error);
        })
        .getAssessorado(id);
    }
    
    function renderModalEditarAssessorado(assessorado) {
      const modalHTML = `
        <div id="modal-editar-assessorado" class="fixed inset-0 modal-backdrop flex items-center justify-center z-40 fade-in">
          <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto m-4">
            
            <!-- Header -->
            <div class="bg-gradient-to-r from-litte-dark to-litte-green text-white px-6 py-4 flex items-center justify-between sticky top-0 z-10 shadow-lg">
              <div>
                <h3 class="text-xl font-bold">âœï¸ Editar Assessorado</h3>
                <p class="text-sm text-litte-cream">ID: ${assessorado.id} - ${assessorado.nome}</p>
              </div>
              <button onclick="closeModal('modal-editar-assessorado')" class="text-2xl hover:text-litte-cream hover:rotate-90 transition-transform">&times;</button>
            </div>
            
            <!-- Body -->
            <div class="p-6">
              <form id="form-editar-assessorado" onsubmit="salvarEdicaoAssessorado(event)">
                <input type="hidden" name="id" value="${assessorado.id}">
                
                <!-- Nome e UsuÃ¡rio -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div>
                    <label class="block text-sm font-medium text-litte-dark mb-2">Nome *</label>
                    <input type="text" name="nome" value="${assessorado.nome}" required 
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-litte-green">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-litte-dark mb-2">UsuÃ¡rio *</label>
                    <input type="text" name="usuario" value="${assessorado.usuario}" required 
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-litte-green">
                  </div>
                </div>
                
                <!-- Contato -->
                <div class="grid grid-cols-3 gap-4 mb-4">
                  <div>
                    <label class="block text-sm font-medium mb-2">Email</label>
                    <input type="email" name="email" value="${assessorado.email || ''}" class="w-full px-4 py-2 border rounded-lg">
                  </div>
                  <div>
                    <label class="block text-sm font-medium mb-2">Telefone</label>
                    <input type="tel" name="telefone" value="${assessorado.telefone || ''}" class="w-full px-4 py-2 border rounded-lg">
                  </div>
                  <div>
                    <label class="block text-sm font-medium mb-2">Idade</label>
                    <input type="number" name="idade" value="${assessorado.idade || ''}" class="w-full px-4 py-2 border rounded-lg">
                  </div>
                </div>
                
                <!-- ObservaÃ§Ãµes e Status -->
                <div class="grid grid-cols-4 gap-4 mb-4">
                  <div class="col-span-3">
                    <label class="block text-sm font-medium mb-2">ObservaÃ§Ãµes</label>
                    <textarea name="observacoes" rows="3" class="w-full px-4 py-2 border rounded-lg">${assessorado.observacoes || ''}</textarea>
                  </div>
                  <div>
                    <label class="block text-sm font-medium mb-2">Status</label>
                    <select name="status" class="w-full px-4 py-2 border rounded-lg">
                      <option value="Ativo" ${assessorado.status === 'Ativo' ? 'selected' : ''}>âœ… Ativo</option>
                      <option value="Inativo" ${assessorado.status !== 'Ativo' ? 'selected' : ''}>âŒ Inativo</option>
                    </select>
                  </div>
                </div>
                
                <!-- BotÃµes -->
                <div class="flex gap-2 justify-end pt-4 border-t-2">
                  <button type="button" onclick="closeModal('modal-editar-assessorado')" 
                    class="px-6 py-2 border-2 border-gray-300 rounded-lg hover:bg-gray-50">
                    Cancelar
                  </button>
                  <button type="submit" class="btn-primary px-6 py-2 rounded-lg">
                    ğŸ’¾ Salvar
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('modals-container').innerHTML = modalHTML;
    }
    
    function salvarEdicaoAssessorado(event) {
      event.preventDefault();
      
      const form = event.target;
      const formData = new FormData(form);
      
      const dados = {
        id: formData.get('id'),
        nome: formData.get('nome'),
        usuario: formData.get('usuario'),
        email: formData.get('email'),
        telefone: formData.get('telefone'),
        idade: formData.get('idade'),
        observacoes: formData.get('observacoes'),
        status: formData.get('status')
      };
      
      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            closeModal('modal-editar-assessorado');
            showToast('âœ… Assessorado atualizado!', 'success');
            cachedData.assessorados = null;
            setTimeout(function() { renderAssessorados(); }, 500);
          } else {
            showToast('âŒ Erro: ' + result.message, 'error');
          }
        })
        .withFailureHandler(function(error) {
          showToast('âŒ Erro ao salvar', 'error');
          console.error(error);
        })
        .atualizarAssessorado(dados);
    }
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //                    UTILITÃRIOS DE MODAL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.remove();
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //                    INICIALIZAÃ‡ÃƒO
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    document.addEventListener('DOMContentLoaded', function() {
      // Carregar dashboard ao iniciar
      renderDashboard();
      
      // Atualizar notificaÃ§Ãµes a cada 30 segundos
      setInterval(function() {
        atualizarContadorNotificacoes();
      }, 30000);
      
      // Primeira atualizaÃ§Ã£o de notificaÃ§Ãµes
      atualizarContadorNotificacoes();
    });
    
    function atualizarContadorNotificacoes() {
      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success && result.count > 0) {
            const badge = document.getElementById('notif-badge');
            badge.textContent = result.count;
            badge.classList.remove('hidden');
          } else {
            document.getElementById('notif-badge').classList.add('hidden');
          }
        })
        .withFailureHandler(function(error) {
          console.error('Erro ao atualizar notificaÃ§Ãµes:', error);
        })
        .contarNotificacoesNaoLidas('TODOS');
    }
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//    PARTE 2A: VIEW PROSPECÃ‡Ã•ES + MODAL ANDAMENTO
//    ADICIONAR ESTE CÃ“DIGO NO INDEX.HTML (substituir as funÃ§Ãµes placeholder)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                    VIEW: PROSPECÃ‡Ã•ES / ANDAMENTOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderProspeccoes() {
  document.getElementById('view-title').textContent = 'ProspecÃ§Ãµes / Andamentos';
  document.getElementById('view-subtitle').textContent = 'Gerenciar contatos e negociaÃ§Ãµes';
  
  document.getElementById('view-actions').innerHTML = `
    <button onclick="openModalNovoAndamento()" class="btn-primary px-4 py-2 rounded-lg flex items-center gap-2">
      <span>â•</span>
      <span>Novo Andamento</span>
    </button>
    <button onclick="refreshProspeccoes()" class="btn-secondary px-4 py-2 rounded-lg flex items-center gap-2">
      <span>ğŸ”„</span>
      <span>Atualizar</span>
    </button>
  `;
  
  document.getElementById('view-content').innerHTML = `
    <div class="bg-white rounded-lg shadow p-8 text-center">
      <div class="spinner mx-auto mb-4"></div>
      <p class="text-gray-600">Carregando prospecÃ§Ãµes...</p>
    </div>
  `;
  
  google.script.run
    .withSuccessHandler(function(prospeccoes) {
      cachedData.prospeccoes = prospeccoes;
      renderTabelaProspeccoes(prospeccoes);
      updateLastSync();
    })
    .withFailureHandler(function(error) {
      document.getElementById('view-content').innerHTML = `
        <div class="bg-white rounded-lg shadow p-8 text-center">
          <p class="text-red-500 mb-4">âŒ Erro ao carregar prospecÃ§Ãµes</p>
          <button onclick="refreshProspeccoes()" class="btn-primary px-4 py-2 rounded-lg">
            Tentar novamente
          </button>
        </div>
      `;
      showToast('Erro ao carregar prospecÃ§Ãµes', 'error');
      console.error(error);
    })
    .getProspeccoes();
}

function renderTabelaProspeccoes(prospeccoes) {
  console.log('ğŸ“Š Renderizando prospecÃ§Ãµes:', prospeccoes.length);
  
  let html = `
    <div class="bg-white rounded-lg shadow">
      <div class="p-4 border-b border-gray-200">
        <p class="text-sm text-gray-600">
          Total de prospecÃ§Ãµes ativas: <strong class="text-litte-dark">${prospeccoes.length}</strong>
        </p>
      </div>
      <div class="table-container">
        <table class="w-full">
          <thead>
            <tr class="border-b border-gray-200">
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">ID</th>
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">Influenciador</th>
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">Marca</th>
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">Objeto</th>
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">Fase</th>
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">Status</th>
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">Valor</th>
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">Ãšltimo Retorno</th>
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">AÃ§Ãµes</th>
            </tr>
          </thead>
          <tbody>
  `;
  
  if (prospeccoes.length === 0) {
    html += `
      <tr>
        <td colspan="9" class="px-6 py-8 text-center text-gray-500">
          Nenhuma prospecÃ§Ã£o ativa no momento.
          <br><br>
          <button onclick="openModalNovoAndamento()" class="btn-primary px-4 py-2 rounded-lg">
            â• Iniciar Nova ProspecÃ§Ã£o
          </button>
        </td>
      </tr>
    `;
  } else {
    prospeccoes.forEach(function(p) {
      const statusBadge = getStatusBadge(p.statusDetalhado);
      const faseBadge = getFaseBadge(p.fase);
      
      html += `
        <tr class="border-b border-gray-100 hover:bg-gray-50">
          <td class="px-6 py-4 text-sm font-mono">${p.idCampanha || '--'}</td>
          <td class="px-6 py-4 text-sm font-medium">${getNomeAssessorado(p.idAssessorado)}</td>
          <td class="px-6 py-4 text-sm">${p.marca || '--'}</td>
          <td class="px-6 py-4 text-sm">${p.objetoCampanha || '--'}</td>
          <td class="px-6 py-4">${faseBadge}</td>
          <td class="px-6 py-4">${statusBadge}</td>
          <td class="px-6 py-4 text-sm font-medium">${formatCurrency(p.valorProposto || 0)}</td>
          <td class="px-6 py-4 text-sm">${formatDate(p.ultimoRetorno)}</td>
          <td class="px-6 py-4">
            <button onclick='editarAndamento(${JSON.stringify(p)})' 
              class="text-litte-dark hover:text-litte-green mr-2" title="Editar">âœï¸</button>
            <button onclick="verDetalhesAndamento('${p.idCampanha}')" 
              class="text-litte-dark hover:text-litte-green" title="Ver detalhes">ğŸ‘ï¸</button>
          </td>
        </tr>
      `;
    });
  }
  
  html += `
          </tbody>
        </table>
      </div>
    </div>
  `;
  
  document.getElementById('view-content').innerHTML = html;
  console.log('âœ… Tabela de prospecÃ§Ãµes renderizada');
}

function getStatusBadge(status) {
  const badges = {
    'Enviado': '<span class="badge badge-info">Enviado</span>',
    'NÃ£o respondido': '<span class="badge badge-warning">NÃ£o respondido</span>',
    'Em negociaÃ§Ã£o': '<span class="badge" style="background: #809076; color: white;">Em negociaÃ§Ã£o</span>',
    'Aguardando resposta': '<span class="badge badge-warning">Aguardando</span>',
    'Recusado': '<span class="badge badge-danger">Recusado</span>',
    'Suspenso': '<span class="badge" style="background: #999; color: white;">Suspenso</span>',
    'Fechado': '<span class="badge badge-success">Fechado</span>'
  };
  return badges[status] || '<span class="badge">' + status + '</span>';
}

function getFaseBadge(fase) {
  const badges = {
    'Primeiro contato': '<span class="badge badge-info">1Âº Contato</span>',
    'NegociaÃ§Ã£o': '<span class="badge" style="background: #809076; color: white;">NegociaÃ§Ã£o</span>',
    'Aguardando resposta': '<span class="badge badge-warning">Aguardando</span>',
    'Recusada': '<span class="badge badge-danger">Recusada</span>',
    'Fechada': '<span class="badge badge-success">Fechada</span>',
    'ConcluÃ­da': '<span class="badge" style="background: #284239; color: white;">ConcluÃ­da</span>'
  };
  return badges[fase] || '<span class="badge">' + fase + '</span>';
}

function getNomeAssessorado(idAssessorado) {
  if (!cachedData.assessorados) return idAssessorado;
  const assessorado = cachedData.assessorados.find(a => a.id === idAssessorado);
  return assessorado ? assessorado.nome : idAssessorado;
}

function refreshProspeccoes() {
  renderProspeccoes();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                    MODAL: NOVO ANDAMENTO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function openModalNovoAndamento() {
  // Carregar lista de assessorados se nÃ£o estiver em cache
  if (!cachedData.assessorados) {
    showLoading('Carregando assessorados...');
    google.script.run
      .withSuccessHandler(function(assessorados) {
        hideLoading();
        cachedData.assessorados = assessorados;
        renderModalNovoAndamento();
      })
      .withFailureHandler(function(error) {
        hideLoading();
        showToast('Erro ao carregar assessorados', 'error');
      })
      .getAllAssessorados();
  } else {
    renderModalNovoAndamento();
  }
}

function renderModalNovoAndamento() {
  const assessoradosOptions = cachedData.assessorados.map(a => 
    `<option value="${a.id}">${a.nome} (${a.usuario})</option>`
  ).join('');
  
  const modalHTML = `
    <div id="modal-novo-andamento" class="fixed inset-0 modal-backdrop flex items-center justify-center z-40 fade-in">
      <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto m-4">
        
        <!-- Header -->
        <div class="bg-litte-dark text-white px-6 py-4 flex items-center justify-between sticky top-0 z-10">
          <h3 class="text-xl font-bold">ğŸ¯ Novo Andamento / ProspecÃ§Ã£o</h3>
          <button onclick="closeModal('modal-novo-andamento')" class="text-2xl hover:text-litte-cream">&times;</button>
        </div>
        
        <!-- Body -->
        <div class="p-6">
          <form id="form-novo-andamento" onsubmit="salvarNovoAndamento(event)">
            
            <!-- Assessorado -->
            <div class="mb-4">
              <label class="block text-sm font-medium text-litte-dark mb-2">Influenciador *</label>
              <select name="idAssessorado" required 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green">
                <option value="">Selecione um influenciador</option>
                ${assessoradosOptions}
              </select>
            </div>
            
            <!-- Marca e Objeto -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-litte-dark mb-2">Marca *</label>
                <input type="text" name="marca" required 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green">
              </div>
              <div>
                <label class="block text-sm font-medium text-litte-dark mb-2">Objeto da Campanha *</label>
                <input type="text" name="objetoCampanha" required 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green"
                  placeholder="Ex: Post no Instagram">
              </div>
            </div>
            
            <!-- Fase e Status -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-litte-dark mb-2">Fase *</label>
                <select name="fase" id="select-fase" required 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green">
                  <option value="Primeiro contato">Primeiro contato</option>
                  <option value="NegociaÃ§Ã£o">NegociaÃ§Ã£o</option>
                  <option value="Aguardando resposta">Aguardando resposta</option>
                  <option value="Recusada">Recusada</option>
                  <option value="Fechada">Fechada</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-litte-dark mb-2">Status Detalhado *</label>
                <select name="statusDetalhado" id="select-status" required onchange="handleStatusChange(this)"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green">
                  <option value="Enviado">Enviado</option>
                  <option value="NÃ£o respondido">NÃ£o respondido</option>
                  <option value="Em negociaÃ§Ã£o">Em negociaÃ§Ã£o</option>
                  <option value="Aguardando resposta">Aguardando resposta</option>
                  <option value="Recusado">Recusado</option>
                  <option value="Suspenso">Suspenso</option>
                  <option value="Fechado">Fechado</option>
                </select>
              </div>
            </div>
            
            <!-- Ãšltima Mensagem (aparece sÃ³ se Recusado) -->
            <div id="campo-ultima-mensagem" class="mb-4 hidden">
              <label class="block text-sm font-medium text-litte-dark mb-2">Ãšltima Mensagem (ObrigatÃ³rio para Recusado) *</label>
              <textarea name="ultimaMensagem" id="textarea-ultima-mensagem" rows="3"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green"
                placeholder="Digite a Ãºltima mensagem recebida ou o motivo da recusa..."></textarea>
            </div>
            
            <!-- Campos Fechado (aparecem sÃ³ se Fechado) -->
            <div id="campos-fechado" class="hidden border-t border-gray-200 pt-4 mb-4">
              <h4 class="text-md font-bold text-litte-dark mb-4">ğŸ“‹ InformaÃ§Ãµes da Campanha Fechada</h4>
              
              <!-- DescriÃ§Ã£o do Escopo -->
              <div class="mb-4">
                <label class="block text-sm font-medium text-litte-dark mb-2">DescriÃ§Ã£o do Escopo *</label>
                <textarea name="descricaoEscopo" rows="3"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green"
                  placeholder="Descreva o escopo completo da campanha..."></textarea>
              </div>
              
              <!-- Valor Fechado -->
              <div class="mb-4">
                <label class="block text-sm font-medium text-litte-dark mb-2">Valor Fechado *</label>
                <input type="number" name="valorFechado" step="0.01" min="0"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green"
                  placeholder="0.00">
              </div>
            </div>
            
            <!-- Valores e Remetente -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-litte-dark mb-2">Valor Proposto</label>
                <input type="number" name="valorProposto" step="0.01" min="0"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green"
                  placeholder="0.00">
              </div>
              <div>
                <label class="block text-sm font-medium text-litte-dark mb-2">Remetente</label>
                <select name="remetente"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green">
                  <option value="LittÃª">LittÃª</option>
                  <option value="Assessorado">Assessorado</option>
                  <option value="AgÃªncia">AgÃªncia</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-litte-dark mb-2">ResponsÃ¡vel LittÃª</label>
                <select name="responsavelLitte"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green">
                  <option value="Anne">Anne</option>
                  <option value="Time LittÃª">Time LittÃª</option>
                  <option value="Comercial">Comercial</option>
                </select>
              </div>
            </div>
            
            <!-- ObservaÃ§Ãµes -->
            <div class="mb-4">
              <label class="block text-sm font-medium text-litte-dark mb-2">ObservaÃ§Ãµes</label>
              <textarea name="observacoes" rows="3"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green"></textarea>
            </div>
            
            <!-- BotÃµes -->
            <div class="flex gap-2 justify-end pt-4">
              <button type="button" onclick="closeModal('modal-novo-andamento')" 
                class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                Cancelar
              </button>
              <button type="submit" 
                class="btn-primary px-6 py-2 rounded-lg flex items-center gap-2">
                <span id="btn-save-andamento-spinner" class="hidden">
                  <div class="spinner"></div>
                </span>
                <span id="btn-save-andamento-text">Salvar Andamento</span>
              </button>
            </div>
            
          </form>
        </div>
        
      </div>
    </div>
  `;
  
  document.getElementById('modals-container').innerHTML = modalHTML;
}

function handleStatusChange(select) {
  const status = select.value;
  const campoUltimaMensagem = document.getElementById('campo-ultima-mensagem');
  const textareaUltimaMensagem = document.getElementById('textarea-ultima-mensagem');
  const camposFechado = document.getElementById('campos-fechado');
  
  // Mostrar campo "Ãšltima Mensagem" se Recusado
  if (status === 'Recusado') {
    campoUltimaMensagem.classList.remove('hidden');
    textareaUltimaMensagem.required = true;
  } else {
    campoUltimaMensagem.classList.add('hidden');
    textareaUltimaMensagem.required = false;
  }
  
  // Mostrar campos extras se Fechado
  if (status === 'Fechado') {
    camposFechado.classList.remove('hidden');
    camposFechado.querySelectorAll('[name="descricaoEscopo"], [name="valorFechado"]').forEach(input => {
      input.required = true;
    });
  } else {
    camposFechado.classList.add('hidden');
    camposFechado.querySelectorAll('[name="descricaoEscopo"], [name="valorFechado"]').forEach(input => {
      input.required = false;
    });
  }
}

function salvarNovoAndamento(event) {
  event.preventDefault();
  
  const form = event.target;
  const formData = new FormData(form);
  
  // Buscar nome do assessorado
  const idAssessorado = formData.get('idAssessorado');
  const assessorado = cachedData.assessorados.find(a => a.id === idAssessorado);
  
  const dados = {
    idAssessorado: idAssessorado,
    marca: formData.get('marca'),
    objetoCampanha: formData.get('objetoCampanha'),
    fase: formData.get('fase'),
    statusDetalhado: formData.get('statusDetalhado'),
    remetente: formData.get('remetente') || 'LittÃª',
    responsavelLitte: formData.get('responsavelLitte') || 'Anne',
    valorProposto: parseFloat(formData.get('valorProposto')) || 0,
    valorFechado: parseFloat(formData.get('valorFechado')) || 0,
    observacoes: formData.get('observacoes') || '',
    descricaoEscopo: formData.get('descricaoEscopo') || '',
    ultimaMensagem: formData.get('ultimaMensagem') || ''
  };
  
  // Mostrar loading
  document.getElementById('btn-save-andamento-spinner').classList.remove('hidden');
  document.getElementById('btn-save-andamento-text').textContent = 'Salvando...';
  form.querySelectorAll('button').forEach(btn => btn.disabled = true);
  
  // Escolher funÃ§Ã£o baseada no status
  const funcao = dados.statusDetalhado === 'Fechado' ? 
    'criarAndamentoComAutomacao' : 'criarAndamentoBasico';
  
  google.script.run
    .withSuccessHandler(function(result) {
      form.querySelectorAll('button').forEach(btn => btn.disabled = false);
      document.getElementById('btn-save-andamento-spinner').classList.add('hidden');
      document.getElementById('btn-save-andamento-text').textContent = 'Salvar Andamento';
      
      if (result.success) {
        closeModal('modal-novo-andamento');
        
        if (dados.statusDetalhado === 'Fechado') {
          showToast('âœ… Campanha fechada! Checklist e automaÃ§Ãµes foram criadas.', 'success');
        } else {
          showToast('âœ… Andamento criado com sucesso!', 'success');
        }
        
        // Limpar cache e recarregar
        cachedData.prospeccoes = null;
        setTimeout(function() {
          renderProspeccoes();
        }, 500);
      } else {
        showToast('âŒ Erro: ' + result.message, 'error');
      }
    })
    .withFailureHandler(function(error) {
      form.querySelectorAll('button').forEach(btn => btn.disabled = false);
      document.getElementById('btn-save-andamento-spinner').classList.add('hidden');
      document.getElementById('btn-save-andamento-text').textContent = 'Salvar Andamento';
      showToast('âŒ Erro ao salvar', 'error');
      console.error(error);
    })
    [funcao](dados);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                    MODAL: EDITAR ANDAMENTO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function editarAndamento(andamento) {
  console.log('ğŸ“ Abrindo modal de ediÃ§Ã£o:', andamento);
  
  // Carregar lista de assessorados se nÃ£o estiver em cache
  if (!cachedData.assessorados) {
    showLoading('Carregando dados...');
    google.script.run
      .withSuccessHandler(function(assessorados) {
        hideLoading();
        cachedData.assessorados = assessorados;
        renderModalEditarAndamento(andamento);
      })
      .withFailureHandler(function(error) {
        hideLoading();
        showToast('Erro ao carregar dados', 'error');
      })
      .getAllAssessorados();
  } else {
    renderModalEditarAndamento(andamento);
  }
}

function renderModalEditarAndamento(andamento) {
  const nomeAssessorado = getNomeAssessorado(andamento.idAssessorado);
  
  const modalHTML = `
    <div id="modal-editar-andamento" class="fixed inset-0 modal-backdrop flex items-center justify-center z-40 fade-in">
      <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto m-4">
        
        <!-- Header -->
        <div class="bg-litte-dark text-white px-6 py-4 flex items-center justify-between sticky top-0 z-10">
          <div>
            <h3 class="text-xl font-bold">âœï¸ Editar Andamento</h3>
            <p class="text-sm text-litte-cream">ID: ${andamento.idCampanha} - ${nomeAssessorado}</p>
          </div>
          <button onclick="closeModal('modal-editar-andamento')" class="text-2xl hover:text-litte-cream">&times;</button>
        </div>
        
        <!-- Body -->
        <div class="p-6">
          <form id="form-editar-andamento" onsubmit="salvarEdicaoAndamento(event)">
            <input type="hidden" name="idCampanha" value="${andamento.idCampanha}">
            
            <!-- Assessorado (readonly) -->
            <div class="mb-4 p-4 bg-gray-50 rounded-lg border-l-4 border-litte-dark">
              <label class="block text-sm font-medium text-litte-dark mb-2">ğŸ‘¤ Influenciador</label>
              <input type="text" value="${nomeAssessorado}" readonly
                class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed">
              <p class="text-xs text-gray-500 mt-1">âš ï¸ O influenciador nÃ£o pode ser alterado apÃ³s criaÃ§Ã£o</p>
            </div>
            
            <!-- Marca e Objeto -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-litte-dark mb-2">ğŸ·ï¸ Marca *</label>
                <input type="text" name="marca" value="${andamento.marca}" required 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent">
              </div>
              <div>
                <label class="block text-sm font-medium text-litte-dark mb-2">ğŸ“¦ Objeto da Campanha *</label>
                <input type="text" name="objetoCampanha" value="${andamento.objetoCampanha || ''}" required 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent">
              </div>
            </div>
            
            <!-- Fase e Status -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-litte-dark mb-2">ğŸ¯ Fase *</label>
                <select name="fase" id="edit-select-fase" required 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent">
                  <option value="Primeiro contato" ${andamento.fase === 'Primeiro contato' ? 'selected' : ''}>Primeiro contato</option>
                  <option value="NegociaÃ§Ã£o" ${andamento.fase === 'NegociaÃ§Ã£o' ? 'selected' : ''}>NegociaÃ§Ã£o</option>
                  <option value="Aguardando resposta" ${andamento.fase === 'Aguardando resposta' ? 'selected' : ''}>Aguardando resposta</option>
                  <option value="Recusada" ${andamento.fase === 'Recusada' ? 'selected' : ''}>Recusada</option>
                  <option value="Fechada" ${andamento.fase === 'Fechada' ? 'selected' : ''}>Fechada</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-litte-dark mb-2">ğŸ“Š Status Detalhado *</label>
                <select name="statusDetalhado" id="edit-select-status" required onchange="handleEditStatusChange(this)"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent">
                  <option value="Enviado" ${andamento.statusDetalhado === 'Enviado' ? 'selected' : ''}>Enviado</option>
                  <option value="NÃ£o respondido" ${andamento.statusDetalhado === 'NÃ£o respondido' ? 'selected' : ''}>NÃ£o respondido</option>
                  <option value="Em negociaÃ§Ã£o" ${andamento.statusDetalhado === 'Em negociaÃ§Ã£o' ? 'selected' : ''}>Em negociaÃ§Ã£o</option>
                  <option value="Aguardando resposta" ${andamento.statusDetalhado === 'Aguardando resposta' ? 'selected' : ''}>Aguardando resposta</option>
                  <option value="Recusado" ${andamento.statusDetalhado === 'Recusado' ? 'selected' : ''}>Recusado</option>
                  <option value="Suspenso" ${andamento.statusDetalhado === 'Suspenso' ? 'selected' : ''}>Suspenso</option>
                  <option value="Fechado" ${andamento.statusDetalhado === 'Fechado' ? 'selected' : ''}>Fechado</option>
                </select>
              </div>
            </div>
            
            <!-- Ãšltima Mensagem (aparece sÃ³ se Recusado) -->
            <div id="edit-campo-ultima-mensagem" class="mb-4 ${andamento.statusDetalhado === 'Recusado' ? '' : 'hidden'}">
              <label class="block text-sm font-medium text-litte-dark mb-2">ğŸ’¬ Ãšltima Mensagem *</label>
              <textarea name="ultimaMensagem" id="edit-textarea-ultima-mensagem" rows="3"
                class="w-full px-4 py-2 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                placeholder="Digite a Ãºltima mensagem recebida ou o motivo da recusa...">${andamento.ultimaMensagem || ''}</textarea>
              <p class="text-xs text-red-600 mt-1">âš ï¸ ObrigatÃ³rio quando status Ã© "Recusado"</p>
            </div>
            
            <!-- Campos Fechado (aparecem sÃ³ se Fechado) -->
            <div id="edit-campos-fechado" class="${andamento.statusDetalhado === 'Fechado' ? '' : 'hidden'} border-2 border-litte-green rounded-lg p-4 mb-4">
              <h4 class="text-md font-bold text-litte-dark mb-4 flex items-center gap-2">
                <span>ğŸ‰</span>
                <span>InformaÃ§Ãµes da Campanha Fechada</span>
              </h4>
              
              <!-- DescriÃ§Ã£o do Escopo -->
              <div class="mb-4">
                <label class="block text-sm font-medium text-litte-dark mb-2">ğŸ“‹ DescriÃ§Ã£o do Escopo *</label>
                <textarea name="descricaoEscopo" rows="3"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                  placeholder="Descreva o escopo completo da campanha...">${andamento.descricaoEscopo || ''}</textarea>
              </div>
              
              <!-- Valor Fechado -->
              <div class="mb-4">
                <label class="block text-sm font-medium text-litte-dark mb-2">ğŸ’° Valor Fechado *</label>
                <input type="number" name="valorFechado" step="0.01" min="0"
                  value="${andamento.valorFechado || ''}"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                  placeholder="0.00">
              </div>
            </div>
            
            <!-- Valores e ResponsÃ¡veis -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-litte-dark mb-2">ğŸ’µ Valor Proposto</label>
                <input type="number" name="valorProposto" step="0.01" min="0"
                  value="${andamento.valorProposto || ''}"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                  placeholder="0.00">
              </div>
              <div>
                <label class="block text-sm font-medium text-litte-dark mb-2">ğŸ“¤ Remetente</label>
                <select name="remetente"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent">
                  <option value="LittÃª" ${andamento.remetente === 'LittÃª' ? 'selected' : ''}>LittÃª</option>
                  <option value="Assessorado" ${andamento.remetente === 'Assessorado' ? 'selected' : ''}>Assessorado</option>
                  <option value="AgÃªncia" ${andamento.remetente === 'AgÃªncia' ? 'selected' : ''}>AgÃªncia</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-litte-dark mb-2">ğŸ‘” ResponsÃ¡vel LittÃª</label>
                <select name="responsavelLitte"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent">
                  <option value="Anne" ${andamento.responsavelLitte === 'Anne' ? 'selected' : ''}>Anne</option>
                  <option value="Time LittÃª" ${andamento.responsavelLitte === 'Time LittÃª' ? 'selected' : ''}>Time LittÃª</option>
                  <option value="Comercial" ${andamento.responsavelLitte === 'Comercial' ? 'selected' : ''}>Comercial</option>
                </select>
              </div>
            </div>
            
            <!-- ObservaÃ§Ãµes -->
            <div class="mb-4">
              <label class="block text-sm font-medium text-litte-dark mb-2">ğŸ“ ObservaÃ§Ãµes</label>
              <textarea name="observacoes" rows="3"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-litte-green focus:border-transparent"
                placeholder="ObservaÃ§Ãµes gerais sobre o andamento...">${andamento.observacoes || ''}</textarea>
            </div>
            
            <!-- Info de CriaÃ§Ã£o (readonly) -->
            <div class="mb-6 p-4 bg-gray-50 rounded-lg border">
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <span class="text-gray-600">ğŸ“… Data de CriaÃ§Ã£o:</span>
                  <span class="font-medium ml-2">${andamento.dataCriacao || '--'}</span>
                </div>
                <div>
                  <span class="text-gray-600">âœ… ConcluÃ­da:</span>
                  <span class="font-medium ml-2">${andamento.concluida ? 'SIM' : 'NÃƒO'}</span>
                </div>
              </div>
            </div>
            
            <!-- BotÃµes -->
            <div class="flex gap-2 justify-end pt-4 border-t-2 border-gray-200">
              <button type="button" onclick="closeModal('modal-editar-andamento')" 
                class="px-6 py-2 border-2 border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition">
                Cancelar
              </button>
              <button type="submit" 
                class="btn-primary px-6 py-2 rounded-lg flex items-center gap-2 font-medium">
                <span id="btn-edit-andamento-spinner" class="hidden">
                  <div class="spinner"></div>
                </span>
                <span id="btn-edit-andamento-text">ğŸ’¾ Salvar AlteraÃ§Ãµes</span>
              </button>
            </div>
            
          </form>
        </div>
        
      </div>
    </div>
  `;
  
  document.getElementById('modals-container').innerHTML = modalHTML;
}

function handleEditStatusChange(select) {
  const status = select.value;
  const campoUltimaMensagem = document.getElementById('edit-campo-ultima-mensagem');
  const textareaUltimaMensagem = document.getElementById('edit-textarea-ultima-mensagem');
  const camposFechado = document.getElementById('edit-campos-fechado');
  
  // Mostrar campo "Ãšltima Mensagem" se Recusado
  if (status === 'Recusado') {
    campoUltimaMensagem.classList.remove('hidden');
    textareaUltimaMensagem.required = true;
  } else {
    campoUltimaMensagem.classList.add('hidden');
    textareaUltimaMensagem.required = false;
  }
  
  // Mostrar campos extras se Fechado
  if (status === 'Fechado') {
    camposFechado.classList.remove('hidden');
    camposFechado.querySelectorAll('[name="descricaoEscopo"], [name="valorFechado"]').forEach(input => {
      input.required = true;
    });
  } else {
    camposFechado.classList.add('hidden');
    camposFechado.querySelectorAll('[name="descricaoEscopo"], [name="valorFechado"]').forEach(input => {
      input.required = false;
    });
  }
}

function salvarEdicaoAndamento(event) {
  event.preventDefault();
  
  const form = event.target;
  const formData = new FormData(form);
  
  const dados = {
    idCampanha: formData.get('idCampanha'),
    marca: formData.get('marca'),
    objetoCampanha: formData.get('objetoCampanha'),
    fase: formData.get('fase'),
    statusDetalhado: formData.get('statusDetalhado'),
    remetente: formData.get('remetente'),
    responsavelLitte: formData.get('responsavelLitte'),
    valorProposto: parseFloat(formData.get('valorProposto')) || 0,
    valorFechado: parseFloat(formData.get('valorFechado')) || 0,
    observacoes: formData.get('observacoes') || '',
    descricaoEscopo: formData.get('descricaoEscopo') || '',
    ultimaMensagem: formData.get('ultimaMensagem') || '',
    usuario: 'Sistema'
  };
  
  // ValidaÃ§Ã£o: se Recusado, Ãºltima mensagem Ã© obrigatÃ³ria
  if (dados.statusDetalhado === 'Recusado' && !dados.ultimaMensagem.trim()) {
    showToast('âŒ Campo "Ãšltima mensagem" Ã© obrigatÃ³rio quando status Ã© Recusado', 'error');
    return;
  }
  
  // ValidaÃ§Ã£o: se Fechado, escopo e valor sÃ£o obrigatÃ³rios
  if (dados.statusDetalhado === 'Fechado') {
    if (!dados.descricaoEscopo.trim()) {
      showToast('âŒ Campo "DescriÃ§Ã£o do Escopo" Ã© obrigatÃ³rio quando status Ã© Fechado', 'error');
      return;
    }
    if (!dados.valorFechado || dados.valorFechado <= 0) {
      showToast('âŒ Campo "Valor Fechado" Ã© obrigatÃ³rio quando status Ã© Fechado', 'error');
      return;
    }
  }
  
  // Mostrar loading
  document.getElementById('btn-edit-andamento-spinner').classList.remove('hidden');
  document.getElementById('btn-edit-andamento-text').textContent = 'Salvando...';
  form.querySelectorAll('button').forEach(btn => btn.disabled = true);
  
  console.log('ğŸ’¾ Salvando andamento:', dados);
  
  google.script.run
    .withSuccessHandler(function(result) {
      form.querySelectorAll('button').forEach(btn => btn.disabled = false);
      document.getElementById('btn-edit-andamento-spinner').classList.add('hidden');
      document.getElementById('btn-edit-andamento-text').textContent = 'ğŸ’¾ Salvar AlteraÃ§Ãµes';
      
      if (result.success) {
        closeModal('modal-editar-andamento');
        showToast('âœ… Andamento atualizado com sucesso!', 'success');
        
        // Limpar cache e recarregar
        cachedData.prospeccoes = null;
        cachedData.campanhas = null;
        
        setTimeout(function() {
          if (currentView === 'prospeccoes') {
            renderProspeccoes();
          } else if (currentView === 'campanhas') {
            renderCampanhas();
          }
        }, 500);
      } else {
        showToast('âŒ Erro: ' + result.message, 'error');
      }
    })
    .withFailureHandler(function(error) {
      form.querySelectorAll('button').forEach(btn => btn.disabled = false);
      document.getElementById('btn-edit-andamento-spinner').classList.add('hidden');
      document.getElementById('btn-edit-andamento-text').textContent = 'ğŸ’¾ Salvar AlteraÃ§Ãµes';
      showToast('âŒ Erro ao salvar', 'error');
      console.error(error);
    })
    .atualizarAndamento(dados);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                    FUNÃ‡ÃƒO 2: VER DETALHES ANDAMENTO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function verDetalhesAndamento(idCampanha) {
  console.log('ğŸ‘ï¸ Carregando detalhes:', idCampanha);
  
  showLoading('Carregando detalhes...');
  
  google.script.run
    .withSuccessHandler(function(andamento) {
      hideLoading();
      
      if (andamento) {
        renderModalDetalhesAndamento(andamento);
      } else {
        showToast('âŒ Andamento nÃ£o encontrado', 'error');
      }
    })
    .withFailureHandler(function(error) {
      hideLoading();
      showToast('âŒ Erro ao carregar detalhes', 'error');
      console.error(error);
    })
    .getAndamento(idCampanha);
}

function renderModalDetalhesAndamento(andamento) {
  const assessorado = cachedData.assessorados ? 
    cachedData.assessorados.find(a => a.id === andamento.idAssessorado) : null;
  
  const nomeInfluenciador = assessorado ? assessorado.nome : andamento.idAssessorado;
  const emailInfluenciador = assessorado ? assessorado.email : '--';
  const telefoneInfluenciador = assessorado ? assessorado.telefone : '--';
  
  const statusBadge = getStatusBadge(andamento.statusDetalhado);
  const faseBadge = getFaseBadge(andamento.fase);
  
  const modalHTML = `
    <div id="modal-detalhes-andamento" class="fixed inset-0 modal-backdrop flex items-center justify-center z-40 fade-in">
      <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto m-4">
        
        <!-- Header -->
        <div class="bg-gradient-to-r from-litte-dark to-litte-green text-white px-6 py-4 flex items-center justify-between sticky top-0 z-10 shadow-lg">
          <div>
            <h3 class="text-xl font-bold">ğŸ‘ï¸ Detalhes do Andamento</h3>
            <p class="text-sm text-litte-cream">${andamento.marca} - ${nomeInfluenciador}</p>
          </div>
          <button onclick="closeModal('modal-detalhes-andamento')" class="text-2xl hover:text-litte-cream hover:rotate-90 transition-transform">&times;</button>
        </div>
        
        <!-- Body -->
        <div class="p-6">
          
          <!-- Info Principal -->
          <div class="bg-gradient-to-r from-litte-dark to-litte-green text-white rounded-lg p-6 mb-6 shadow-lg">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <p class="text-sm text-litte-cream mb-1">ğŸ†” ID da Campanha</p>
                <p class="text-2xl font-bold">${andamento.idCampanha}</p>
              </div>
              <div>
                <p class="text-sm text-litte-cream mb-1">ğŸ·ï¸ Marca</p>
                <p class="text-2xl font-bold">${andamento.marca}</p>
              </div>
            </div>
          </div>
          
          <!-- Status e Fase -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="bg-white border-2 border-litte-dark rounded-lg p-4 hover:shadow-lg transition">
              <p class="text-sm text-gray-600 mb-2 font-medium">ğŸ¯ Fase Atual</p>
              <div class="text-lg">${faseBadge}</div>
            </div>
            <div class="bg-white border-2 border-litte-green rounded-lg p-4 hover:shadow-lg transition">
              <p class="text-sm text-gray-600 mb-2 font-medium">ğŸ“Š Status Detalhado</p>
              <div class="text-lg">${statusBadge}</div>
            </div>
          </div>
          
          <!-- InformaÃ§Ãµes da Campanha -->
          <div class="bg-gray-50 rounded-lg p-6 mb-6 border-2 border-gray-200">
            <h4 class="text-lg font-bold text-litte-dark mb-4 flex items-center gap-2">
              <span>ğŸ“‹</span>
              <span>InformaÃ§Ãµes da Campanha</span>
            </h4>
            <div class="space-y-3">
              <div class="grid grid-cols-3 gap-4">
                <div class="bg-white p-3 rounded border">
                  <p class="text-xs text-gray-500 mb-1">Objeto</p>
                  <p class="font-medium">${andamento.objetoCampanha || '--'}</p>
                </div>
                <div class="bg-white p-3 rounded border">
                  <p class="text-xs text-gray-500 mb-1">Remetente</p>
                  <p class="font-medium">${andamento.remetente || '--'}</p>
                </div>
                <div class="bg-white p-3 rounded border">
                  <p class="text-xs text-gray-500 mb-1">ResponsÃ¡vel</p>
                  <p class="font-medium">${andamento.responsavelLitte || '--'}</p>
                </div>
              </div>
              
              <div class="grid grid-cols-2 gap-4 pt-3 border-t-2">
                <div class="bg-orange-50 p-4 rounded-lg border-2 border-orange-200">
                  <p class="text-sm text-gray-600 mb-1">ğŸ’µ Valor Proposto</p>
                  <p class="font-bold text-2xl text-litte-orange">${formatCurrency(andamento.valorProposto || 0)}</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg border-2 border-green-200">
                  <p class="text-sm text-gray-600 mb-1">ğŸ’° Valor Fechado</p>
                  <p class="font-bold text-2xl text-litte-green">${formatCurrency(andamento.valorFechado || 0)}</p>
                </div>
              </div>
              
              ${andamento.descricaoEscopo ? `
              <div class="pt-3 border-t-2">
                <p class="text-sm text-gray-600 mb-2 font-medium">ğŸ“ DescriÃ§Ã£o do Escopo</p>
                <p class="text-gray-800 bg-white p-4 rounded-lg border-2 border-gray-200">${andamento.descricaoEscopo}</p>
              </div>
              ` : ''}
            </div>
          </div>
          
          <!-- InformaÃ§Ãµes do Influenciador -->
          <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-6">
            <h4 class="text-lg font-bold text-litte-dark mb-4 flex items-center gap-2">
              <span>ğŸ‘¤</span>
              <span>Influenciador</span>
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="bg-white p-3 rounded border">
                <p class="text-xs text-gray-500 mb-1">Nome</p>
                <p class="font-medium">${nomeInfluenciador}</p>
              </div>
              <div class="bg-white p-3 rounded border">
                <p class="text-xs text-gray-500 mb-1">Email</p>
                <p class="font-medium text-sm">${emailInfluenciador}</p>
              </div>
              <div class="bg-white p-3 rounded border">
                <p class="text-xs text-gray-500 mb-1">Telefone</p>
                <p class="font-medium">${telefoneInfluenciador}</p>
              </div>
            </div>
          </div>
          
          <!-- Datas -->
          <div class="bg-purple-50 border-2 border-purple-200 rounded-lg p-6 mb-6">
            <h4 class="text-lg font-bold text-litte-dark mb-4 flex items-center gap-2">
              <span>ğŸ“…</span>
              <span>Datas</span>
            </h4>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
              <div class="bg-white p-3 rounded border">
                <p class="text-xs text-gray-500 mb-1">CriaÃ§Ã£o</p>
                <p class="font-medium">${andamento.dataCriacao || '--'}</p>
              </div>
              <div class="bg-white p-3 rounded border">
                <p class="text-xs text-gray-500 mb-1">Ãšltimo Retorno</p>
                <p class="font-medium">${andamento.ultimoRetorno || '--'}</p>
              </div>
              <div class="bg-white p-3 rounded border">
                <p class="text-xs text-gray-500 mb-1">ConcluÃ­da</p>
                <p class="font-bold ${andamento.concluida ? 'text-green-600' : 'text-red-600'}">
                  ${andamento.concluida ? 'âœ… SIM' : 'âŒ NÃƒO'}
                </p>
              </div>
            </div>
          </div>
          
          <!-- ObservaÃ§Ãµes -->
          ${andamento.observacoes ? `
          <div class="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-6 mb-6">
            <h4 class="text-lg font-bold text-litte-dark mb-4 flex items-center gap-2">
              <span>ğŸ“</span>
              <span>ObservaÃ§Ãµes</span>
            </h4>
            <p class="text-gray-800 bg-white p-4 rounded-lg border-2 border-gray-200">${andamento.observacoes}</p>
          </div>
          ` : ''}
          
          <!-- Ãšltima Mensagem (se Recusado) -->
          ${andamento.statusDetalhado === 'Recusado' && andamento.ultimaMensagem ? `
          <div class="bg-red-50 border-2 border-red-300 rounded-lg p-6 mb-6">
            <h4 class="text-lg font-bold text-red-700 mb-4 flex items-center gap-2">
              <span>ğŸ’¬</span>
              <span>Ãšltima Mensagem (Recusado)</span>
            </h4>
            <p class="text-gray-800 bg-white p-4 rounded-lg border-2 border-red-200">${andamento.ultimaMensagem}</p>
          </div>
          ` : ''}
          
          <!-- Links -->
          ${andamento.linkPastaCampanha ? `
          <div class="bg-gray-50 border-2 border-gray-200 rounded-lg p-6 mb-6">
            <h4 class="text-lg font-bold text-litte-dark mb-4 flex items-center gap-2">
              <span>ğŸ”—</span>
              <span>Links</span>
            </h4>
            <a href="${andamento.linkPastaCampanha}" target="_blank" 
              class="inline-flex items-center gap-2 px-4 py-2 bg-litte-dark text-white rounded-lg hover:bg-litte-green transition">
              <span>ğŸ“</span>
              <span>Abrir Pasta da Campanha no Drive</span>
            </a>
          </div>
          ` : ''}
          
          <!-- BotÃµes de AÃ§Ã£o -->
          <div class="flex gap-2 justify-end pt-4 border-t-2 border-gray-200">
            <button onclick="closeModal('modal-detalhes-andamento')" 
              class="px-6 py-2 border-2 border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition">
              Fechar
            </button>
            <button onclick="closeModal('modal-detalhes-andamento'); editarAndamento(${JSON.stringify(andamento).replace(/"/g, '&quot;')})" 
              class="btn-primary px-6 py-2 rounded-lg flex items-center gap-2 font-medium">
              <span>âœï¸</span>
              <span>Editar Andamento</span>
            </button>
          </div>
          
        </div>
        
      </div>
    </div>
  `;
  
  document.getElementById('modals-container').innerHTML = modalHTML;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                    FUNÃ‡Ã•ES AUXILIARES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getStatusBadge(status) {
  const badges = {
    'Enviado': '<span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">ğŸ“¤ Enviado</span>',
    'NÃ£o respondido': '<span class="px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm font-medium">â³ NÃ£o respondido</span>',
    'Em negociaÃ§Ã£o': '<span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium">ğŸ’¬ Em negociaÃ§Ã£o</span>',
    'Aguardando resposta': '<span class="px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm font-medium">â° Aguardando resposta</span>',
    'Recusado': '<span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium">âŒ Recusado</span>',
    'Suspenso': '<span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium">â¸ï¸ Suspenso</span>',
    'Fechado': '<span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">âœ… Fechado</span>'
  };
  return badges[status] || '<span class="px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm">'+status+'</span>';
}

function getFaseBadge(fase) {
  const badges = {
    'Primeiro contato': '<span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">ğŸ¯ Primeiro contato</span>',
    'NegociaÃ§Ã£o': '<span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium">ğŸ’¬ NegociaÃ§Ã£o</span>',
    'Aguardando resposta': '<span class="px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm font-medium">â° Aguardando</span>',
    'Recusada': '<span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium">âŒ Recusada</span>',
    'Fechada': '<span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">âœ… Fechada</span>'
  };
  return badges[fase] || '<span class="px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm">'+fase+'</span>';
}

function getNomeAssessorado(idAssessorado) {
  if (!cachedData.assessorados) return idAssessorado;
  const assessorado = cachedData.assessorados.find(a => a.id === idAssessorado);
  return assessorado ? assessorado.nome : idAssessorado;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//    PARTE 2B: VIEW CAMPANHAS ATIVAS + MODAL CHECKLIST
//    ADICIONAR ESTE CÃ“DIGO NO INDEX.HTML
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                    VIEW: CAMPANHAS ATIVAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderCampanhas() {
  document.getElementById('view-title').textContent = 'Campanhas Ativas';
  document.getElementById('view-subtitle').textContent = 'Acompanhamento de campanhas fechadas';
  
  document.getElementById('view-actions').innerHTML = `
    <button onclick="refreshCampanhas()" class="btn-secondary px-4 py-2 rounded-lg flex items-center gap-2">
      <span>ğŸ”„</span>
      <span>Atualizar</span>
    </button>
  `;
  
  document.getElementById('view-content').innerHTML = `
    <div class="bg-white rounded-lg shadow p-8 text-center">
      <div class="spinner mx-auto mb-4"></div>
      <p class="text-gray-600">Carregando campanhas ativas...</p>
    </div>
  `;
  
  google.script.run
    .withSuccessHandler(function(campanhas) {
      cachedData.campanhas = campanhas;
      renderTabelaCampanhas(campanhas);
      updateLastSync();
    })
    .withFailureHandler(function(error) {
      document.getElementById('view-content').innerHTML = `
        <div class="bg-white rounded-lg shadow p-8 text-center">
          <p class="text-red-500 mb-4">âŒ Erro ao carregar campanhas</p>
          <button onclick="refreshCampanhas()" class="btn-primary px-4 py-2 rounded-lg">
            Tentar novamente
          </button>
        </div>
      `;
      showToast('Erro ao carregar campanhas', 'error');
      console.error(error);
    })
    .getCampanhasAtivas();
}

function renderTabelaCampanhas(campanhas) {
  console.log('ğŸ“Š Renderizando campanhas ativas:', campanhas.length);
  
  let html = `
    <div class="bg-white rounded-lg shadow">
      <div class="p-4 border-b border-gray-200">
        <p class="text-sm text-gray-600">
          Campanhas em execuÃ§Ã£o: <strong class="text-litte-dark">${campanhas.length}</strong>
        </p>
      </div>
      <div class="table-container">
        <table class="w-full">
          <thead>
            <tr class="border-b border-gray-200">
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">ID</th>
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">Influenciador</th>
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">Marca</th>
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">Valor Total</th>
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">PrÃ³ximo Prazo</th>
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">ResponsÃ¡vel</th>
              <th class="text-left px-6 py-3 text-sm font-semibold text-white">AÃ§Ãµes</th>
            </tr>
          </thead>
          <tbody>
  `;
  
  if (campanhas.length === 0) {
    html += `
      <tr>
        <td colspan="7" class="px-6 py-8 text-center text-gray-500">
          Nenhuma campanha ativa no momento.
          <br><br>
          Campanhas aparecem aqui apÃ³s serem fechadas em ProspecÃ§Ãµes.
        </td>
      </tr>
    `;
  } else {
    campanhas.forEach(function(c) {
      const prazoClass = isPrazoProximo(c.proximoPrazo) ? 'text-red-600 font-bold' : '';
      
      html += `
        <tr class="border-b border-gray-100 hover:bg-gray-50">
          <td class="px-6 py-4 text-sm font-mono">${c.idCampanha || '--'}</td>
          <td class="px-6 py-4 text-sm font-medium">${c.influenciador || '--'}</td>
          <td class="px-6 py-4 text-sm">${c.marca || '--'}</td>
          <td class="px-6 py-4 text-sm font-medium">${formatCurrency(c.valorTotal || 0)}</td>
          <td class="px-6 py-4 text-sm ${prazoClass}">${formatDate(c.proximoPrazo)}</td>
          <td class="px-6 py-4 text-sm">${c.responsavel || '--'}</td>
          <td class="px-6 py-4">
            <button onclick="openModalChecklist('${c.idCampanha}')" 
              class="text-litte-dark hover:text-litte-green mr-2" title="Checklist">ğŸ“‹</button>
            <button onclick="openModalFinanceiroCampanha('${c.idCampanha}')" 
              class="text-litte-dark hover:text-litte-green" title="Financeiro">ğŸ’°</button>
          </td>
        </tr>
      `;
    });
  }
  
  html += `
          </tbody>
        </table>
      </div>
    </div>
  `;
  
  document.getElementById('view-content').innerHTML = html;
  console.log('âœ… Tabela de campanhas renderizada');
}

function isPrazoProximo(data) {
  if (!data) return false;
  const prazo = new Date(data);
  const hoje = new Date();
  const diffDias = Math.ceil((prazo - hoje) / (1000 * 60 * 60 * 24));
  return diffDias <= 3 && diffDias >= 0;
}

function refreshCampanhas() {
  renderCampanhas();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                    MODAL: CHECKLIST COMPLETO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function openModalChecklist(idCampanha) {
  showLoading('Carregando checklist...');
  
  google.script.run
    .withSuccessHandler(function(checklist) {
      hideLoading();
      if (checklist) {
        renderModalChecklist(checklist);
      } else {
        showToast('Checklist nÃ£o encontrado', 'error');
      }
    })
    .withFailureHandler(function(error) {
      hideLoading();
      showToast('Erro ao carregar checklist', 'error');
      console.error(error);
    })
    .getChecklistCompleto(idCampanha);
}

function renderModalChecklist(checklist) {
  const modalHTML = `
    <div id="modal-checklist" class="fixed inset-0 modal-backdrop flex items-center justify-center z-40 fade-in">
      <div class="bg-white rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] overflow-y-auto m-4">
        
        <!-- Header -->
        <div class="bg-litte-dark text-white px-6 py-4 flex items-center justify-between sticky top-0 z-10">
          <div>
            <h3 class="text-xl font-bold">ğŸ“‹ Checklist Completo</h3>
            <p class="text-sm text-litte-cream">${checklist.marca} - ${checklist.nomeAssessorado}</p>
          </div>
          <button onclick="closeModal('modal-checklist')" class="text-2xl hover:text-litte-cream">&times;</button>
        </div>
        
        <!-- Body com Abas -->
        <div class="p-6">
          
          <!-- Tabs Navigation -->
          <div class="border-b border-gray-200 mb-6">
            <nav class="flex gap-4">
              <button onclick="switchChecklistTab('contrato')" 
                class="checklist-tab active px-4 py-2 border-b-2 border-litte-dark font-medium">
                ğŸ“ Contrato
              </button>
              <button onclick="switchChecklistTab('produto')" 
                class="checklist-tab px-4 py-2 border-b-2 border-transparent hover:border-gray-300">
                ğŸ“¦ Produto
              </button>
              <button onclick="switchChecklistTab('roteiro')" 
                class="checklist-tab px-4 py-2 border-b-2 border-transparent hover:border-gray-300">
                ğŸ¬ Roteiro
              </button>
              <button onclick="switchChecklistTab('conteudo')" 
                class="checklist-tab px-4 py-2 border-b-2 border-transparent hover:border-gray-300">
                âœ… ConteÃºdo
              </button>
              <button onclick="switchChecklistTab('postagem')" 
                class="checklist-tab px-4 py-2 border-b-2 border-transparent hover:border-gray-300">
                ğŸš€ Postagem
              </button>
              <button onclick="switchChecklistTab('metricas')" 
                class="checklist-tab px-4 py-2 border-b-2 border-transparent hover:border-gray-300">
                ğŸ“Š MÃ©tricas
              </button>
              <button onclick="switchChecklistTab('nf')" 
                class="checklist-tab px-4 py-2 border-b-2 border-transparent hover:border-gray-300">
                ğŸ§¾ NF
              </button>
              <button onclick="switchChecklistTab('repasse')" 
                class="checklist-tab px-4 py-2 border-b-2 border-transparent hover:border-gray-300">
                ğŸ’¸ Repasse
              </button>
            </nav>
          </div>
          
          <!-- Tab Content -->
          <form id="form-checklist" onsubmit="salvarChecklist(event)">
            <input type="hidden" name="idCampanha" value="${checklist.idCampanha}">
            
            <!-- ABA: CONTRATO -->
            <div id="tab-contrato" class="tab-content">
              ${renderTabContrato(checklist)}
            </div>
            
            <!-- ABA: PRODUTO -->
            <div id="tab-produto" class="tab-content hidden">
              ${renderTabProduto(checklist)}
            </div>
            
            <!-- ABA: ROTEIRO -->
            <div id="tab-roteiro" class="tab-content hidden">
              ${renderTabRoteiro(checklist)}
            </div>
            
            <!-- ABA: CONTEÃšDO -->
            <div id="tab-conteudo" class="tab-content hidden">
              ${renderTabConteudo(checklist)}
            </div>
            
            <!-- ABA: POSTAGEM -->
            <div id="tab-postagem" class="tab-content hidden">
              ${renderTabPostagem(checklist)}
            </div>
            
            <!-- ABA: MÃ‰TRICAS -->
            <div id="tab-metricas" class="tab-content hidden">
              ${renderTabMetricas(checklist)}
            </div>
            
            <!-- ABA: NF -->
            <div id="tab-nf" class="tab-content hidden">
              ${renderTabNF(checklist)}
            </div>
            
            <!-- ABA: REPASSE -->
            <div id="tab-repasse" class="tab-content hidden">
              ${renderTabRepasse(checklist)}
            </div>
            
            <!-- BotÃµes -->
            <div class="flex gap-2 justify-end pt-6 border-t border-gray-200 mt-6">
              <button type="button" onclick="closeModal('modal-checklist')" 
                class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                Fechar
              </button>
              <button type="submit" 
                class="btn-primary px-6 py-2 rounded-lg flex items-center gap-2">
                <span id="btn-save-checklist-spinner" class="hidden">
                  <div class="spinner"></div>
                </span>
                <span id="btn-save-checklist-text">ğŸ’¾ Salvar AlteraÃ§Ãµes</span>
              </button>
            </div>
            
          </form>
          
        </div>
        
      </div>
    </div>
  `;
  
  document.getElementById('modals-container').innerHTML = modalHTML;
}

// FunÃ§Ãµes para renderizar cada aba do checklist

function renderTabContrato(c) {
  return `
    <div class="space-y-4">
      <h4 class="text-lg font-bold text-litte-dark mb-4">ğŸ“ Contrato / Briefing</h4>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Precisa Contrato?</label>
          <select name="precisaContrato" class="w-full px-4 py-2 border rounded-lg">
            <option value="">Selecione</option>
            <option value="Sim" ${c.precisaContrato === 'Sim' ? 'selected' : ''}>Sim</option>
            <option value="NÃ£o" ${c.precisaContrato === 'NÃ£o' ? 'selected' : ''}>NÃ£o</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Status do Contrato</label>
          <select name="statusContrato" class="w-full px-4 py-2 border rounded-lg">
            <option value="">Selecione</option>
            <option value="NÃ£o iniciado" ${c.statusContrato === 'NÃ£o iniciado' ? 'selected' : ''}>NÃ£o iniciado</option>
            <option value="Aguardando assinatura" ${c.statusContrato === 'Aguardando assinatura' ? 'selected' : ''}>Aguardando assinatura</option>
            <option value="Assinado" ${c.statusContrato === 'Assinado' ? 'selected' : ''}>Assinado</option>
            <option value="Enviado para marca" ${c.statusContrato === 'Enviado para marca' ? 'selected' : ''}>Enviado para marca</option>
          </select>
        </div>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Data Prevista Assinatura</label>
          <input type="date" name="dataPrevAssinaturaContrato" value="${c.dataPrevAssinaturaContrato || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Data Real Assinatura</label>
          <input type="date" name="dataRealAssinaturaContrato" value="${c.dataRealAssinaturaContrato || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
      </div>
      
      <div>
        <label class="block text-sm font-medium mb-2">Link do Contrato</label>
        <input type="url" name="linkContrato" value="${c.linkContrato || ''}"
          class="w-full px-4 py-2 border rounded-lg" placeholder="https://...">
      </div>
      
      <div>
        <label class="block text-sm font-medium mb-2">ObservaÃ§Ãµes do Contrato</label>
        <textarea name="obsContrato" rows="3" class="w-full px-4 py-2 border rounded-lg">${c.obsContrato || ''}</textarea>
      </div>
      
      <div class="pt-4">
        <button type="button" onclick="criarEventoChecklist('${c.idCampanha}', 'CONTRATO', document.querySelector('[name=dataPrevAssinaturaContrato]').value, '${c.nomeAssessorado}', '${c.marca}')"
          class="btn-secondary px-4 py-2 rounded-lg">
          ğŸ“… Criar Evento na Agenda
        </button>
      </div>
    </div>
  `;
}

function renderTabProduto(c) {
  return `
    <div class="space-y-4">
      <h4 class="text-lg font-bold text-litte-dark mb-4">ğŸ“¦ Produto</h4>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Precisa Produto?</label>
          <select name="precisaProduto" class="w-full px-4 py-2 border rounded-lg">
            <option value="">Selecione</option>
            <option value="Sim" ${c.precisaProduto === 'Sim' ? 'selected' : ''}>Sim</option>
            <option value="NÃ£o" ${c.precisaProduto === 'NÃ£o' ? 'selected' : ''}>NÃ£o</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Nome do Produto</label>
          <input type="text" name="nomeProduto" value="${c.nomeProduto || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
      </div>
      
      <div class="grid grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Quantidade</label>
          <input type="number" name="quantidade" value="${c.quantidade || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Valor do Produto</label>
          <input type="number" name="valorProduto" step="0.01" value="${c.valorProduto || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Status do Produto</label>
          <select name="statusProduto" class="w-full px-4 py-2 border rounded-lg">
            <option value="">Selecione</option>
            <option value="Aguardando envio" ${c.statusProduto === 'Aguardando envio' ? 'selected' : ''}>Aguardando envio</option>
            <option value="Enviado" ${c.statusProduto === 'Enviado' ? 'selected' : ''}>Enviado</option>
            <option value="Recebido" ${c.statusProduto === 'Recebido' ? 'selected' : ''}>Recebido</option>
            <option value="Devolvido" ${c.statusProduto === 'Devolvido' ? 'selected' : ''}>Devolvido</option>
          </select>
        </div>
      </div>
      
      <div>
        <label class="block text-sm font-medium mb-2">EndereÃ§o de Envio</label>
        <textarea name="enderecoEnvio" rows="2" class="w-full px-4 py-2 border rounded-lg">${c.enderecoEnvio || ''}</textarea>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Data de Envio</label>
          <input type="date" name="dataEnvioProduto" value="${c.dataEnvioProduto || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">CÃ³digo de Rastreio</label>
          <input type="text" name="codigoRastreio" value="${c.codigoRastreio || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
      </div>
      
      <div>
        <label class="block text-sm font-medium mb-2">Link de Rastreamento</label>
        <input type="url" name="linkRastreamento" value="${c.linkRastreamento || ''}"
          class="w-full px-4 py-2 border rounded-lg" placeholder="https://...">
      </div>
    </div>
  `;
}

function renderTabRoteiro(c) {
  return `
    <div class="space-y-4">
      <h4 class="text-lg font-bold text-litte-dark mb-4">ğŸ¬ Roteiro</h4>
      
      <div class="grid grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Precisa Roteiro?</label>
          <select name="precisaRoteiro" class="w-full px-4 py-2 border rounded-lg">
            <option value="">Selecione</option>
            <option value="Sim" ${c.precisaRoteiro === 'Sim' ? 'selected' : ''}>Sim</option>
            <option value="NÃ£o" ${c.precisaRoteiro === 'NÃ£o' ? 'selected' : ''}>NÃ£o</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Tipo de Roteiro</label>
          <input type="text" name="tipoRoteiro" value="${c.tipoRoteiro || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Status do Roteiro</label>
          <select name="statusRoteiro" class="w-full px-4 py-2 border rounded-lg">
            <option value="">Selecione</option>
            <option value="Aguardando" ${c.statusRoteiro === 'Aguardando' ? 'selected' : ''}>Aguardando</option>
            <option value="Em revisÃ£o" ${c.statusRoteiro === 'Em revisÃ£o' ? 'selected' : ''}>Em revisÃ£o</option>
            <option value="Aprovado" ${c.statusRoteiro === 'Aprovado' ? 'selected' : ''}>Aprovado</option>
          </select>
        </div>
      </div>
      
      <div class="grid grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Data Prevista Roteiro</label>
          <input type="date" name="dataPrevRoteiro" value="${c.dataPrevRoteiro || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Data Real Roteiro</label>
          <input type="date" name="dataRealRoteiro" value="${c.dataRealRoteiro || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Data AprovaÃ§Ã£o</label>
          <input type="date" name="dataAprovRoteiro" value="${c.dataAprovRoteiro || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
      </div>
      
      <div>
        <label class="block text-sm font-medium mb-2">Link Pasta Roteiro (Google Docs)</label>
        <input type="url" name="linkPastaRoteiro" value="${c.linkPastaRoteiro || ''}"
          class="w-full px-4 py-2 border rounded-lg" placeholder="https://docs.google.com/...">
      </div>
      
      <div>
        <label class="block text-sm font-medium mb-2">Feedback do Cliente</label>
        <textarea name="feedbackClienteRoteiro" rows="3" class="w-full px-4 py-2 border rounded-lg">${c.feedbackClienteRoteiro || ''}</textarea>
      </div>
      
      <div class="pt-4">
        <button type="button" onclick="criarEventoChecklist('${c.idCampanha}', 'ROTEIRO', document.querySelector('[name=dataPrevRoteiro]').value, '${c.nomeAssessorado}', '${c.marca}')"
          class="btn-secondary px-4 py-2 rounded-lg">
          ğŸ“… Criar Evento na Agenda
        </button>
      </div>
    </div>
  `;
}

function renderTabConteudo(c) {
  return `
    <div class="space-y-4">
      <h4 class="text-lg font-bold text-litte-dark mb-4">âœ… ConteÃºdo / AprovaÃ§Ã£o</h4>
      
      <div class="grid grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Status do ConteÃºdo</label>
          <select name="statusConteudo" class="w-full px-4 py-2 border rounded-lg">
            <option value="">Selecione</option>
            <option value="Aguardando envio" ${c.statusConteudo === 'Aguardando envio' ? 'selected' : ''}>Aguardando envio</option>
            <option value="Em anÃ¡lise" ${c.statusConteudo === 'Em anÃ¡lise' ? 'selected' : ''}>Em anÃ¡lise</option>
            <option value="Aprovado" ${c.statusConteudo === 'Aprovado' ? 'selected' : ''}>Aprovado</option>
            <option value="Reprovado" ${c.statusConteudo === 'Reprovado' ? 'selected' : ''}>Reprovado</option>
            <option value="Reenviar" ${c.statusConteudo === 'Reenviar' ? 'selected' : ''}>Reenviar</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Tipo de ConteÃºdo</label>
          <select name="tipoConteudo" class="w-full px-4 py-2 border rounded-lg">
            <option value="">Selecione</option>
            <option value="Reels" ${c.tipoConteudo === 'Reels' ? 'selected' : ''}>Reels</option>
            <option value="Story" ${c.tipoConteudo === 'Story' ? 'selected' : ''}>Story</option>
            <option value="Feed" ${c.tipoConteudo === 'Feed' ? 'selected' : ''}>Feed</option>
            <option value="TikTok" ${c.tipoConteudo === 'TikTok' ? 'selected' : ''}>TikTok</option>
            <option value="Shorts" ${c.tipoConteudo === 'Shorts' ? 'selected' : ''}>Shorts</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Formato</label>
          <input type="text" name="formato" value="${c.formato || ''}"
            class="w-full px-4 py-2 border rounded-lg" placeholder="Ex: 1080x1920">
        </div>
      </div>
      
      <div class="grid grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Data Prevista Envio</label>
          <input type="date" name="dataPrevConteudo" value="${c.dataPrevConteudo || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Data Real Envio</label>
          <input type="date" name="dataRealConteudo" value="${c.dataRealConteudo || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Data AprovaÃ§Ã£o</label>
          <input type="date" name="dataAprovConteudo" value="${c.dataAprovConteudo || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
      </div>
      
      <div>
        <label class="block text-sm font-medium mb-2">Link Pasta AprovaÃ§Ã£o (Drive)</label>
        <input type="url" name="linkPastaAprovacao" value="${c.linkPastaAprovacao || ''}"
          class="w-full px-4 py-2 border rounded-lg" placeholder="https://drive.google.com/...">
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">NÃºmero de Ajustes</label>
          <input type="number" name="numeroAjustes" value="${c.numeroAjustes || 0}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Aprovador</label>
          <input type="text" name="aprovador" value="${c.aprovador || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
      </div>
      
      <div class="pt-4">
        <button type="button" onclick="criarEventoChecklist('${c.idCampanha}', 'CONTEUDO', document.querySelector('[name=dataPrevConteudo]').value, '${c.nomeAssessorado}', '${c.marca}')"
          class="btn-secondary px-4 py-2 rounded-lg">
          ğŸ“… Criar Evento na Agenda
        </button>
      </div>
    </div>
  `;
}

function renderTabPostagem(c) {
  return `
    <div class="space-y-4">
      <h4 class="text-lg font-bold text-litte-dark mb-4">ğŸš€ Postagem</h4>
      
      <div class="grid grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Status da Postagem</label>
          <select name="statusPostagem" class="w-full px-4 py-2 border rounded-lg">
            <option value="">Selecione</option>
            <option value="Programado" ${c.statusPostagem === 'Programado' ? 'selected' : ''}>Programado</option>
            <option value="Postado" ${c.statusPostagem === 'Postado' ? 'selected' : ''}>Postado</option>
            <option value="Repostado" ${c.statusPostagem === 'Repostado' ? 'selected' : ''}>Repostado</option>
            <option value="Atrasado" ${c.statusPostagem === 'Atrasado' ? 'selected' : ''}>Atrasado</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Rede Social</label>
          <input type="text" name="redeSocial" value="${c.redeSocial || ''}"
            class="w-full px-4 py-2 border rounded-lg" placeholder="Instagram, TikTok...">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Tipo de Post</label>
          <input type="text" name="tipoPost" value="${c.tipoPost || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Data Prevista Postagem</label>
          <input type="date" name="dataPrevPostagem" value="${c.dataPrevPostagem || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">HorÃ¡rio da Postagem</label>
          <input type="time" name="horarioPostagem" value="${c.horarioPostagem || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Data Real Postagem</label>
          <input type="date" name="dataRealPostagem" value="${c.dataRealPostagem || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Link da Postagem</label>
          <input type="url" name="linkPostagem" value="${c.linkPostagem || ''}"
            class="w-full px-4 py-2 border rounded-lg" placeholder="https://instagram.com/...">
        </div>
      </div>
      
      <div class="grid grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Alcance Esperado</label>
          <input type="number" name="alcanceEsperado" value="${c.alcanceEsperado || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Alcance Real</label>
          <input type="number" name="alcanceReal" value="${c.alcanceReal || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Engajamento (%)</label>
          <input type="text" name="engajamento" value="${c.engajamento || ''}"
            class="w-full px-4 py-2 border rounded-lg" placeholder="5.2%">
        </div>
      </div>
      
      <div class="pt-4">
        <button type="button" onclick="criarEventoChecklist('${c.idCampanha}', 'POSTAGEM', document.querySelector('[name=dataPrevPostagem]').value, '${c.nomeAssessorado}', '${c.marca}')"
          class="btn-secondary px-4 py-2 rounded-lg">
          ğŸ“… Criar Evento na Agenda
        </button>
      </div>
    </div>
  `;
}

function renderTabMetricas(c) {
  return `
    <div class="space-y-4">
      <h4 class="text-lg font-bold text-litte-dark mb-4">ğŸ“Š MÃ©tricas / Resultados</h4>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Data Prevista Coleta</label>
          <input type="date" name="dataPrevColetaMetricas" value="${c.dataPrevColetaMetricas || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Status das MÃ©tricas</label>
          <select name="statusMetricas" class="w-full px-4 py-2 border rounded-lg">
            <option value="">Selecione</option>
            <option value="Aguardando" ${c.statusMetricas === 'Aguardando' ? 'selected' : ''}>Aguardando</option>
            <option value="Coletado" ${c.statusMetricas === 'Coletado' ? 'selected' : ''}>Coletado</option>
            <option value="Enviado" ${c.statusMetricas === 'Enviado' ? 'selected' : ''}>Enviado</option>
            <option value="Incompleto" ${c.statusMetricas === 'Incompleto' ? 'selected' : ''}>Incompleto</option>
          </select>
        </div>
      </div>
      
      <div>
        <label class="block text-sm font-medium mb-2">Link MÃ©tricas (Planilha/Screenshot)</label>
        <input type="url" name="linkMetricas" value="${c.linkMetricas || ''}"
          class="w-full px-4 py-2 border rounded-lg" placeholder="https://...">
      </div>
      
      <div>
        <label class="block text-sm font-medium mb-2">MÃ©tricas Detalhadas</label>
        <textarea name="metricasDetalhadas" rows="4" class="w-full px-4 py-2 border rounded-lg" 
          placeholder="ImpressÃµes, alcance, curtidas, comentÃ¡rios, salvamentos, compartilhamentos...">${c.metricasDetalhadas || ''}</textarea>
      </div>
      
      <div class="pt-4">
        <button type="button" onclick="criarEventoChecklist('${c.idCampanha}', 'METRICAS', document.querySelector('[name=dataPrevColetaMetricas]').value, '${c.nomeAssessorado}', '${c.marca}')"
          class="btn-secondary px-4 py-2 rounded-lg">
          ğŸ“… Criar Evento na Agenda
        </button>
      </div>
    </div>
  `;
}

function renderTabNF(c) {
  return `
    <div class="space-y-4">
      <h4 class="text-lg font-bold text-litte-dark mb-4">ğŸ§¾ Nota Fiscal</h4>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Status da NF</label>
          <select name="statusNF" class="w-full px-4 py-2 border rounded-lg">
            <option value="">Selecione</option>
            <option value="NÃ£o emitida" ${c.statusNF === 'NÃ£o emitida' ? 'selected' : ''}>NÃ£o emitida</option>
            <option value="Emitida" ${c.statusNF === 'Emitida' ? 'selected' : ''}>Emitida</option>
            <option value="Enviada" ${c.statusNF === 'Enviada' ? 'selected' : ''}>Enviada</option>
            <option value="Corrigir" ${c.statusNF === 'Corrigir' ? 'selected' : ''}>Corrigir</option>
            <option value="Aprovada" ${c.statusNF === 'Aprovada' ? 'selected' : ''}>Aprovada</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Tipo de NF</label>
          <input type="text" name="tipoNF" value="${c.tipoNF || 'SERVIÃ‡O'}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">NÃºmero da NF</label>
          <input type="text" name="numeroNF" value="${c.numeroNF || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">CNPJ Emissor</label>
          <input type="text" name="cnpjEmissor" value="${c.cnpjEmissor || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
      </div>
      
      <div class="grid grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Data EmissÃ£o</label>
          <input type="date" name="dataEmissaoNF" value="${c.dataEmissaoNF || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Valor da NF</label>
          <input type="number" name="valorNF" step="0.01" value="${c.valorNF || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Impostos</label>
          <input type="number" name="impostos" step="0.01" value="${c.impostos || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
      </div>
      
      <div>
        <label class="block text-sm font-medium mb-2">Valor LÃ­quido (apÃ³s impostos)</label>
        <input type="number" name="valorLiquidoNF" step="0.01" value="${c.valorLiquidoNF || ''}"
          class="w-full px-4 py-2 border rounded-lg">
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Link PDF da NF</label>
          <input type="url" name="linkNFPDF" value="${c.linkNFPDF || ''}"
            class="w-full px-4 py-2 border rounded-lg" placeholder="https://...">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Link XML</label>
          <input type="url" name="linkXML" value="${c.linkXML || ''}"
            class="w-full px-4 py-2 border rounded-lg" placeholder="https://...">
        </div>
      </div>
    </div>
  `;
}

function renderTabRepasse(c) {
  return `
    <div class="space-y-4">
      <h4 class="text-lg font-bold text-litte-dark mb-4">ğŸ’¸ Repasse ao Influenciador</h4>
      
      <div class="grid grid-cols-3 gap-4 bg-litte-cream bg-opacity-20 p-4 rounded-lg">
        <div>
          <label class="block text-sm font-medium mb-2">Valor Total Campanha</label>
          <input type="number" name="valorTotalPagamento" step="0.01" value="${c.valorTotalPagamento || ''}"
            class="w-full px-4 py-2 border rounded-lg font-bold" readonly>
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Repasse 80% (Influenciador)</label>
          <input type="number" name="valorRepasse80" step="0.01" value="${c.valorRepasse80 || ''}"
            class="w-full px-4 py-2 border rounded-lg font-bold text-litte-green">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Taxa LittÃª 20%</label>
          <input type="number" name="taxaLitte20" step="0.01" value="${c.taxaLitte20 || ''}"
            class="w-full px-4 py-2 border rounded-lg font-bold text-litte-orange">
        </div>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2">Status do Repasse</label>
          <select name="statusRepasse" class="w-full px-4 py-2 border rounded-lg">
            <option value="">Selecione</option>
            <option value="Aguardando pagamento" ${c.statusRepasse === 'Aguardando pagamento' ? 'selected' : ''}>Aguardando pagamento</option>
            <option value="Pago" ${c.statusRepasse === 'Pago' ? 'selected' : ''}>Pago</option>
            <option value="Atrasado" ${c.statusRepasse === 'Atrasado' ? 'selected' : ''}>Atrasado</option>
            <option value="Comprovante enviado" ${c.statusRepasse === 'Comprovante enviado' ? 'selected' : ''}>Comprovante enviado</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Data do Repasse</label>
          <input type="date" name="dataRepasse" value="${c.dataRepasse || ''}"
            class="w-full px-4 py-2 border rounded-lg">
        </div>
      </div>
      
      <div>
        <label class="block text-sm font-medium mb-2">Link do Comprovante</label>
        <input type="url" name="comprovanteRepasse" value="${c.comprovanteRepasse || ''}"
          class="w-full px-4 py-2 border rounded-lg" placeholder="https://...">
      </div>
      
      <div class="pt-4">
        <button type="button" onclick="criarEventoChecklist('${c.idCampanha}', 'REPASSE', document.querySelector('[name=dataRepasse]').value, '${c.nomeAssessorado}', '${c.marca}')"
          class="btn-secondary px-4 py-2 rounded-lg">
          ğŸ“… Criar Evento na Agenda
        </button>
      </div>
    </div>
  `;
}

// FunÃ§Ãµes auxiliares do checklist

function switchChecklistTab(tabName) {
  // Desativar todos os tabs e conteÃºdos
  document.querySelectorAll('.checklist-tab').forEach(tab => {
    tab.classList.remove('active', 'border-litte-dark', 'text-litte-dark');
    tab.classList.add('border-transparent');
  });
  
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.add('hidden');
  });
  
  // Ativar tab e conteÃºdo selecionados
  event.target.classList.add('active', 'border-litte-dark', 'text-litte-dark');
  event.target.classList.remove('border-transparent');
  document.getElementById('tab-' + tabName).classList.remove('hidden');
}

function salvarChecklist(event) {
  event.preventDefault();
  
  const form = event.target;
  const formData = new FormData(form);
  
  const dados = {
    idCampanha: formData.get('idCampanha')
  };
  
  // Coletar todos os campos do formulÃ¡rio
  for (let pair of formData.entries()) {
    if (pair[0] !== 'idCampanha') {
      dados[pair[0]] = pair[1];
    }
  }
  
  // Mostrar loading
  document.getElementById('btn-save-checklist-spinner').classList.remove('hidden');
  document.getElementById('btn-save-checklist-text').textContent = 'Salvando...';
  form.querySelectorAll('button').forEach(btn => btn.disabled = true);
  
  google.script.run
    .withSuccessHandler(function(result) {
      form.querySelectorAll('button').forEach(btn => btn.disabled = false);
      document.getElementById('btn-save-checklist-spinner').classList.add('hidden');
      document.getElementById('btn-save-checklist-text').textContent = 'ğŸ’¾ Salvar AlteraÃ§Ãµes';
      
      if (result.success) {
        showToast('âœ… Checklist atualizado com sucesso!', 'success');
        
        // Sincronizar campanhas ativas
        google.script.run.sincronizarCampanhasAtivas();
      } else {
        showToast('âŒ Erro: ' + result.message, 'error');
      }
    })
    .withFailureHandler(function(error) {
      form.querySelectorAll('button').forEach(btn => btn.disabled = false);
      document.getElementById('btn-save-checklist-spinner').classList.add('hidden');
      document.getElementById('btn-save-checklist-text').textContent = 'ğŸ’¾ Salvar AlteraÃ§Ãµes';
      showToast('âŒ Erro ao salvar', 'error');
      console.error(error);
    })
    .updateChecklistCompleto(dados);
}

function criarEventoChecklist(idCampanha, etapa, data, nomeInfluenciador, marca) {
  if (!data) {
    showToast('âš ï¸ Preencha a data antes de criar o evento', 'warning');
    return;
  }
  
  showLoading('Criando evento...');
  
  google.script.run
    .withSuccessHandler(function(result) {
      hideLoading();
      if (result.success) {
        showToast('âœ… Evento criado no Google Agenda!', 'success');
      } else {
        showToast('âŒ Erro ao criar evento: ' + result.message, 'error');
      }
    })
    .withFailureHandler(function(error) {
      hideLoading();
      showToast('âŒ Erro ao criar evento', 'error');
      console.error(error);
    })
    .criarEventoChecklistEtapa(idCampanha, etapa, data, nomeInfluenciador, marca);
}

function openModalFinanceiroCampanha(idCampanha) {
  showToast('Modal financeiro serÃ¡ implementado na Parte 2C', 'info');
}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//    PARTE 2C: VIEW FINANCEIRO + RELATÃ“RIOS
//    ADICIONAR ESTE CÃ“DIGO NO INDEX.HTML
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                    VIEW: FINANCEIRO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderFinanceiro() {
  document.getElementById('view-title').textContent = 'Financeiro';
  document.getElementById('view-subtitle').textContent = 'GestÃ£o financeira e mÃ©tricas';
  
  document.getElementById('view-actions').innerHTML = `
    <button onclick="gerarRelatorioMensal()" class="btn-primary px-4 py-2 rounded-lg flex items-center gap-2">
      <span>ğŸ“…</span>
      <span>Gerar RelatÃ³rio Mensal</span>
    </button>
    <button onclick="refreshFinanceiro()" class="btn-secondary px-4 py-2 rounded-lg flex items-center gap-2">
      <span>ğŸ”„</span>
      <span>Atualizar</span>
    </button>
  `;
  
  document.getElementById('view-content').innerHTML = `
    <div class="bg-white rounded-lg shadow p-8 text-center">
      <div class="spinner mx-auto mb-4"></div>
      <p class="text-gray-600">Carregando dados financeiros...</p>
    </div>
  `;
  
  google.script.run
    .withSuccessHandler(function(result) {
      if (result.success) {
        renderFinanceiroContent(result);
        updateLastSync();
      } else {
        showToast('Erro ao carregar mÃ©tricas: ' + result.message, 'error');
      }
    })
    .withFailureHandler(function(error) {
      document.getElementById('view-content').innerHTML = `
        <div class="bg-white rounded-lg shadow p-8 text-center">
          <p class="text-red-500 mb-4">âŒ Erro ao carregar financeiro</p>
          <button onclick="refreshFinanceiro()" class="btn-primary px-4 py-2 rounded-lg">
            Tentar novamente
          </button>
        </div>
      `;
      showToast('Erro ao carregar financeiro', 'error');
      console.error(error);
    })
    .getMetricasFinanceiras();
}

function renderFinanceiroContent(metricas) {
  console.log('ğŸ“Š Renderizando financeiro:', metricas);
  
  const html = `
    <!-- Cards de MÃ©tricas -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
      
      <!-- Total Recebido -->
      <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-green-700 mb-1">Total Recebido (MÃªs)</p>
            <p class="text-3xl font-bold text-green-800">${formatCurrency(metricas.totalRecebido)}</p>
          </div>
          <div class="text-4xl">ğŸ’°</div>
        </div>
      </div>
      
      <!-- Total a Receber -->
      <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-orange-700 mb-1">Total a Receber</p>
            <p class="text-3xl font-bold text-orange-800">${formatCurrency(metricas.totalReceber)}</p>
          </div>
          <div class="text-4xl">ğŸ“Š</div>
        </div>
      </div>
      
      <!-- Faturamento Anual -->
      <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-blue-700 mb-1">Faturamento Ano</p>
            <p class="text-3xl font-bold text-blue-800">${formatCurrency(metricas.faturamentoAno)}</p>
          </div>
          <div class="text-4xl">ğŸ“ˆ</div>
        </div>
      </div>
      
      <!-- Saldo Projetado -->
      <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-purple-700 mb-1">Saldo Projetado</p>
            <p class="text-3xl font-bold text-purple-800">${formatCurrency(metricas.saldoProjetado)}</p>
          </div>
          <div class="text-4xl">ğŸ¯</div>
        </div>
      </div>
      
    </div>
    
    <!-- DivisÃ£o SÃ³cios -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
      
      <!-- Bryan -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-bold text-litte-dark mb-4">ğŸ‘¤ Bryan</h3>
        <div class="space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-gray-600">Recebido:</span>
            <span class="text-xl font-bold text-green-600">${formatCurrency(metricas.bryanRecebido)}</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-600">A Receber:</span>
            <span class="text-xl font-bold text-orange-600">${formatCurrency(metricas.bryanReceber)}</span>
          </div>
          <div class="border-t pt-3">
            <div class="flex justify-between items-center">
              <span class="font-medium">Total:</span>
              <span class="text-2xl font-bold text-litte-dark">${formatCurrency(metricas.bryanRecebido + metricas.bryanReceber)}</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Roberta -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-bold text-litte-dark mb-4">ğŸ‘¤ Roberta</h3>
        <div class="space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-gray-600">Recebido:</span>
            <span class="text-xl font-bold text-green-600">${formatCurrency(metricas.robertaRecebido)}</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-600">A Receber:</span>
            <span class="text-xl font-bold text-orange-600">${formatCurrency(metricas.robertaReceber)}</span>
          </div>
          <div class="border-t pt-3">
            <div class="flex justify-between items-center">
              <span class="font-medium">Total:</span>
              <span class="text-2xl font-bold text-litte-dark">${formatCurrency(metricas.robertaRecebido + metricas.robertaReceber)}</span>
            </div>
          </div>
        </div>
      </div>
      
    </div>
    
    <!-- Fluxo de Caixa -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <h3 class="text-lg font-bold text-litte-dark mb-4">ğŸ’¸ Fluxo de Caixa</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        
        <div class="text-center p-4 bg-green-50 rounded-lg">
          <p class="text-sm text-gray-600 mb-2">Entradas Previstas</p>
          <p class="text-2xl font-bold text-green-600">${formatCurrency(metricas.entradasPrevistas)}</p>
        </div>
        
        <div class="text-center p-4 bg-red-50 rounded-lg">
          <p class="text-sm text-gray-600 mb-2">SaÃ­das Previstas</p>
          <p class="text-2xl font-bold text-red-600">${formatCurrency(metricas.saidasPrevistas)}</p>
        </div>
        
        <div class="text-center p-4 bg-blue-50 rounded-lg">
          <p class="text-sm text-gray-600 mb-2">Saldo Previsto</p>
          <p class="text-2xl font-bold ${metricas.saldoProjetado >= 0 ? 'text-blue-600' : 'text-red-600'}">
            ${formatCurrency(metricas.saldoProjetado)}
          </p>
        </div>
        
      </div>
    </div>
    
    <!-- Tabela de Financeiros -->
    <div class="bg-white rounded-lg shadow">
      <div class="p-4 border-b border-gray-200">
        <h3 class="text-lg font-bold text-litte-dark">ğŸ“‹ Detalhamento Financeiro</h3>
      </div>
      <div id="tabela-financeiro-container">
        <p class="text-center text-gray-500 py-8">Carregando detalhes...</p>
      </div>
    </div>
  `;
  
  document.getElementById('view-content').innerHTML = html;
  
  // Carregar tabela detalhada
  carregarTabelaFinanceiro();
}

function carregarTabelaFinanceiro() {
  google.script.run
    .withSuccessHandler(function(financeiros) {
      renderTabelaFinanceiro(financeiros);
    })
    .withFailureHandler(function(error) {
      document.getElementById('tabela-financeiro-container').innerHTML = `
        <p class="text-center text-red-500 py-8">Erro ao carregar detalhes</p>
      `;
    })
    .getAllFinanceirosCompletos();
}

function renderTabelaFinanceiro(financeiros) {
  let html = `
    <div class="table-container">
      <table class="w-full">
        <thead>
          <tr class="border-b border-gray-200">
            <th class="text-left px-6 py-3 text-sm font-semibold text-white">ID</th>
            <th class="text-left px-6 py-3 text-sm font-semibold text-white">Influenciador</th>
            <th class="text-left px-6 py-3 text-sm font-semibold text-white">Marca</th>
            <th class="text-left px-6 py-3 text-sm font-semibold text-white">Valor Total</th>
            <th class="text-left px-6 py-3 text-sm font-semibold text-white">Status Pagamento</th>
            <th class="text-left px-6 py-3 text-sm font-semibold text-white">Status Repasse</th>
            <th class="text-left px-6 py-3 text-sm font-semibold text-white">AÃ§Ãµes</th>
          </tr>
        </thead>
        <tbody>
  `;
  
  if (financeiros.length === 0) {
    html += `
      <tr>
        <td colspan="7" class="px-6 py-8 text-center text-gray-500">
          Nenhum registro financeiro ainda.
        </td>
      </tr>
    `;
  } else {
    financeiros.forEach(function(f) {
      const badgePagamento = getFinanceiroBadge(f.statusPagamentoCliente);
      const badgeRepasse = getFinanceiroBadge(f.statusRepasse);
      
      html += `
        <tr class="border-b border-gray-100 hover:bg-gray-50">
          <td class="px-6 py-4 text-sm font-mono">${f.idCampanha || '--'}</td>
          <td class="px-6 py-4 text-sm font-medium">${f.nomeAssessorado || '--'}</td>
          <td class="px-6 py-4 text-sm">${f.marca || '--'}</td>
          <td class="px-6 py-4 text-sm font-bold">${formatCurrency(f.valorTotal || 0)}</td>
          <td class="px-6 py-4">${badgePagamento}</td>
          <td class="px-6 py-4">${badgeRepasse}</td>
          <td class="px-6 py-4">
            <button onclick="openModalFinanceiroDetalhes('${f.idCampanha}')" 
              class="text-litte-dark hover:text-litte-green" title="Ver detalhes">ğŸ‘ï¸</button>
          </td>
        </tr>
      `;
    });
  }
  
  html += `
        </tbody>
      </table>
    </div>
  `;
  
  document.getElementById('tabela-financeiro-container').innerHTML = html;
}

function getFinanceiroBadge(status) {
  const badges = {
    'PENDENTE': '<span class="badge badge-warning">Pendente</span>',
    'Em aberto': '<span class="badge badge-warning">Em aberto</span>',
    'PAGO': '<span class="badge badge-success">Pago</span>',
    'Pago': '<span class="badge badge-success">Pago</span>',
    'ATRASADO': '<span class="badge badge-danger">Atrasado</span>',
    'Atrasado': '<span class="badge badge-danger">Atrasado</span>',
    'AGUARDANDO NF': '<span class="badge badge-info">Aguardando NF</span>',
    'Aguardando pagamento': '<span class="badge badge-warning">Aguardando</span>',
    'Comprovante enviado': '<span class="badge badge-info">Comprovante enviado</span>'
  };
  return badges[status] || '<span class="badge">' + status + '</span>';
}

function refreshFinanceiro() {
  renderFinanceiro();
}

function gerarRelatorioMensal() {
  showLoading('Gerando relatÃ³rio mensal...');
  
  google.script.run
    .withSuccessHandler(function(result) {
      hideLoading();
      if (result.success) {
        showToast('âœ… RelatÃ³rio mensal gerado com sucesso!', 'success');
      } else {
        showToast('âŒ Erro: ' + result.message, 'error');
      }
    })
    .withFailureHandler(function(error) {
      hideLoading();
      showToast('âŒ Erro ao gerar relatÃ³rio', 'error');
      console.error(error);
    })
    .gerarRelatorioMensalAutomatico();
}

function openModalFinanceiroDetalhes(idCampanha) {
  showToast('Modal de detalhes financeiros (em desenvolvimento)', 'info');
  console.log('Financeiro detalhes:', idCampanha);
}
 // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//    PARTE 2D: VIEWS RESTANTES (Templates, Notas, NotificaÃ§Ãµes, Config)
//    ADICIONAR ESTE CÃ“DIGO NO INDEX.HTML
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                    VIEW: TEMPLATES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderTemplates() {
  document.getElementById('view-title').textContent = 'Templates';
  document.getElementById('view-subtitle').textContent = 'Mensagens e respostas prontas';
  
  document.getElementById('view-actions').innerHTML = `
    <button onclick="openModalNovoTemplate()" class="btn-primary px-4 py-2 rounded-lg flex items-center gap-2">
      <span>â•</span>
      <span>Novo Template</span>
    </button>
    <button onclick="refreshTemplates()" class="btn-secondary px-4 py-2 rounded-lg flex items-center gap-2">
      <span>ğŸ”„</span>
      <span>Atualizar</span>
    </button>
  `;
  
  document.getElementById('view-content').innerHTML = `
    <div class="bg-white rounded-lg shadow p-8 text-center">
      <div class="spinner mx-auto mb-4"></div>
      <p class="text-gray-600">Carregando templates...</p>
    </div>
  `;
  
  google.script.run
    .withSuccessHandler(function(templates) {
      cachedData.templates = templates;
      renderListaTemplates(templates);
      updateLastSync();
    })
    .withFailureHandler(function(error) {
      document.getElementById('view-content').innerHTML = `
        <div class="bg-white rounded-lg shadow p-8 text-center">
          <p class="text-red-500 mb-4">âŒ Erro ao carregar templates</p>
          <button onclick="refreshTemplates()" class="btn-primary px-4 py-2 rounded-lg">
            Tentar novamente
          </button>
        </div>
      `;
      showToast('Erro ao carregar templates', 'error');
      console.error(error);
    })
    .getAllTemplates();
}

function renderListaTemplates(templates) {
  console.log('ğŸ“Š Renderizando templates:', templates.length);
  
  // Agrupar por categoria
  const categorias = {};
  templates.forEach(function(t) {
    const cat = t.categoria || 'Outros';
    if (!categorias[cat]) categorias[cat] = [];
    categorias[cat].push(t);
  });
  
  let html = '<div class="space-y-6">';
  
  if (templates.length === 0) {
    html += `
      <div class="bg-white rounded-lg shadow p-8 text-center">
        <p class="text-gray-500 mb-4">Nenhum template cadastrado ainda.</p>
        <button onclick="openModalNovoTemplate()" class="btn-primary px-4 py-2 rounded-lg">
          â• Criar Primeiro Template
        </button>
      </div>
    `;
  } else {
    Object.keys(categorias).forEach(function(categoria) {
      html += `
        <div class="bg-white rounded-lg shadow">
          <div class="px-6 py-4 bg-litte-dark text-white font-bold">
            ğŸ“‚ ${categoria}
          </div>
          <div class="p-6 space-y-4">
      `;
      
      categorias[categoria].forEach(function(t) {
        html += `
          <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
            <div class="flex items-start justify-between mb-2">
              <div class="flex-1">
                <h4 class="font-bold text-litte-dark">${t.nome}</h4>
                <p class="text-sm text-gray-600 mt-1"><strong>Assunto:</strong> ${t.assunto || '--'}</p>
              </div>
              <div class="flex gap-2 ml-4">
                <button onclick="copiarTemplate('${t.id}')" 
                  class="text-litte-dark hover:text-litte-green" title="Copiar">ğŸ“‹</button>
                <button onclick="editarTemplate('${t.id}')" 
                  class="text-litte-dark hover:text-litte-green" title="Editar">âœï¸</button>
              </div>
            </div>
            <div class="text-sm text-gray-700 bg-gray-50 p-3 rounded">
              ${t.corpo ? t.corpo.substring(0, 200) + (t.corpo.length > 200 ? '...' : '') : '--'}
            </div>
          </div>
        `;
      });
      
      html += `
          </div>
        </div>
      `;
    });
  }
  
  html += '</div>';
  
  document.getElementById('view-content').innerHTML = html;
}

function refreshTemplates() {
  renderTemplates();
}

function openModalNovoTemplate() {
  showToast('Funcionalidade em desenvolvimento', 'info');
}

function copiarTemplate(id) {
  const template = cachedData.templates.find(t => t.id === id);
  if (template) {
    // Copiar para clipboard
    navigator.clipboard.writeText(template.corpo).then(function() {
      showToast('âœ… Template copiado para a Ã¡rea de transferÃªncia!', 'success');
    });
  }
}

function editarTemplate(id) {
  showToast('Funcionalidade em desenvolvimento', 'info');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                    VIEW: NOTAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderNotas() {
  document.getElementById('view-title').textContent = 'Notas';
  document.getElementById('view-subtitle').textContent = 'AnotaÃ§Ãµes e observaÃ§Ãµes';
  
  document.getElementById('view-actions').innerHTML = `
    <button onclick="openModalNovaNota()" class="btn-primary px-4 py-2 rounded-lg flex items-center gap-2">
      <span>â•</span>
      <span>Nova Nota</span>
    </button>
    <button onclick="refreshNotas()" class="btn-secondary px-4 py-2 rounded-lg flex items-center gap-2">
      <span>ğŸ”„</span>
      <span>Atualizar</span>
    </button>
  `;
  
  document.getElementById('view-content').innerHTML = `
    <div class="bg-white rounded-lg shadow p-12 text-center">
      <div class="text-6xl mb-4">ğŸ“‹</div>
      <h3 class="text-xl font-bold text-litte-dark mb-2">Notas do Sistema</h3>
      <p class="text-gray-600 mb-6">
        Adicione anotaÃ§Ãµes importantes sobre campanhas, assessorados ou processos.
      </p>
      <button onclick="openModalNovaNota()" class="btn-primary px-6 py-3 rounded-lg">
        â• Criar Primeira Nota
      </button>
    </div>
  `;
}

function refreshNotas() {
  renderNotas();
}

function openModalNovaNota() {
  showToast('Funcionalidade em desenvolvimento', 'info');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                    VIEW: NOTIFICAÃ‡Ã•ES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderNotificacoes() {
  document.getElementById('view-title').textContent = 'NotificaÃ§Ãµes';
  document.getElementById('view-subtitle').textContent = 'Central de notificaÃ§Ãµes do sistema';
  
  document.getElementById('view-actions').innerHTML = `
    <button onclick="marcarTodasComoLidas()" class="btn-secondary px-4 py-2 rounded-lg flex items-center gap-2">
      <span>âœ“</span>
      <span>Marcar Todas como Lidas</span>
    </button>
    <button onclick="refreshNotificacoes()" class="btn-secondary px-4 py-2 rounded-lg flex items-center gap-2">
      <span>ğŸ”„</span>
      <span>Atualizar</span>
    </button>
  `;
  
  document.getElementById('view-content').innerHTML = `
    <div class="bg-white rounded-lg shadow p-8 text-center">
      <div class="spinner mx-auto mb-4"></div>
      <p class="text-gray-600">Carregando notificaÃ§Ãµes...</p>
    </div>
  `;
  
  google.script.run
    .withSuccessHandler(function(notificacoes) {
      cachedData.notificacoes = notificacoes;
      renderListaNotificacoes(notificacoes);
      updateLastSync();
    })
    .withFailureHandler(function(error) {
      document.getElementById('view-content').innerHTML = `
        <div class="bg-white rounded-lg shadow p-8 text-center">
          <p class="text-red-500 mb-4">âŒ Erro ao carregar notificaÃ§Ãµes</p>
          <button onclick="refreshNotificacoes()" class="btn-primary px-4 py-2 rounded-lg">
            Tentar novamente
          </button>
        </div>
      `;
      showToast('Erro ao carregar notificaÃ§Ãµes', 'error');
      console.error(error);
    })
    .getNotificacoes('TODOS', false);
}

function renderListaNotificacoes(notificacoes) {
  console.log('ğŸ“Š Renderizando notificaÃ§Ãµes:', notificacoes.length);
  
  let html = '';
  
  if (notificacoes.length === 0) {
    html = `
      <div class="bg-white rounded-lg shadow p-12 text-center">
        <div class="text-6xl mb-4">ğŸ””</div>
        <h3 class="text-xl font-bold text-litte-dark mb-2">Nenhuma NotificaÃ§Ã£o</h3>
        <p class="text-gray-600">VocÃª estÃ¡ em dia! Nenhuma notificaÃ§Ã£o pendente.</p>
      </div>
    `;
  } else {
    html = '<div class="space-y-3">';
    
    notificacoes.forEach(function(n) {
      const bgClass = n.lida ? 'bg-white' : 'bg-blue-50';
      const borderClass = n.lida ? 'border-gray-200' : 'border-blue-300';
      const prioridadeColor = n.prioridade === 'ALTA' ? 'text-red-600' : 
                              n.prioridade === 'MÃ‰DIA' ? 'text-orange-600' : 'text-gray-600';
      
      html += `
        <div class="${bgClass} border ${borderClass} rounded-lg p-4 hover:shadow-md transition">
          <div class="flex items-start gap-4">
            <div class="text-3xl">${n.icone || 'ğŸ””'}</div>
            <div class="flex-1">
              <div class="flex items-start justify-between mb-1">
                <h4 class="font-bold text-litte-dark">${n.titulo}</h4>
                <span class="text-xs ${prioridadeColor}">${n.prioridade}</span>
              </div>
              <p class="text-sm text-gray-700 mb-2">${n.mensagem}</p>
              <div class="flex items-center gap-4 text-xs text-gray-500">
                <span>ğŸ“… ${n.dataCriacao}</span>
                ${n.idCampanha ? '<span>ğŸ¬ ' + n.idCampanha + '</span>' : ''}
                ${!n.lida ? '<button onclick="marcarComoLida(\'' + n.idNotificacao + '\')" class="text-blue-600 hover:underline">Marcar como lida</button>' : '<span class="text-green-600">âœ“ Lida</span>'}
              </div>
            </div>
          </div>
        </div>
      `;
    });
    
    html += '</div>';
  }
  
  document.getElementById('view-content').innerHTML = html;
}

function refreshNotificacoes() {
  renderNotificacoes();
}

function marcarComoLida(idNotificacao) {
  google.script.run
    .withSuccessHandler(function(result) {
      if (result.success) {
        showToast('âœ… Marcada como lida', 'success');
        refreshNotificacoes();
        atualizarContadorNotificacoes();
      }
    })
    .withFailureHandler(function(error) {
      showToast('Erro ao marcar como lida', 'error');
    })
    .marcarNotificacaoLida(idNotificacao);
}

function marcarTodasComoLidas() {
  google.script.run
    .withSuccessHandler(function(result) {
      if (result.success) {
        showToast('âœ… Todas marcadas como lidas (' + result.count + ')', 'success');
        refreshNotificacoes();
        atualizarContadorNotificacoes();
      }
    })
    .withFailureHandler(function(error) {
      showToast('Erro ao marcar notificaÃ§Ãµes', 'error');
    })
    .marcarTodasNotificacoesLidas('TODOS');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                    VIEW: CONFIGURAÃ‡Ã•ES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderConfig() {
  document.getElementById('view-title').textContent = 'ConfiguraÃ§Ãµes';
  document.getElementById('view-subtitle').textContent = 'Ajustes e preferÃªncias do sistema';
  
  document.getElementById('view-actions').innerHTML = `
    <button onclick="testarIntegracoes()" class="btn-secondary px-4 py-2 rounded-lg flex items-center gap-2">
      <span>ğŸ§ª</span>
      <span>Testar IntegraÃ§Ãµes</span>
    </button>
  `;
  
  const html = `
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      
      <!-- IntegraÃ§Ãµes -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-bold text-litte-dark mb-4">ğŸ”— IntegraÃ§Ãµes</h3>
        <div class="space-y-4">
          
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
            <div>
              <p class="font-medium">Google Drive</p>
              <p class="text-sm text-gray-600">Armazenamento de arquivos</p>
            </div>
            <span class="badge badge-success">Conectado</span>
          </div>
          
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
            <div>
              <p class="font-medium">Google Calendar</p>
              <p class="text-sm text-gray-600">GestÃ£o de eventos e prazos</p>
            </div>
            <span class="badge badge-success">Conectado</span>
          </div>
          
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
            <div>
              <p class="font-medium">Google Sheets</p>
              <p class="text-sm text-gray-600">Base de dados</p>
            </div>
            <span class="badge badge-success">Conectado</span>
          </div>
          
        </div>
      </div>
      
      <!-- InformaÃ§Ãµes do Sistema -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-bold text-litte-dark mb-4">â„¹ï¸ InformaÃ§Ãµes</h3>
        <div class="space-y-3">
          <div class="flex justify-between">
            <span class="text-gray-600">VersÃ£o:</span>
            <span class="font-medium">v3.5</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Ambiente:</span>
            <span class="font-medium">Google Apps Script</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Framework:</span>
            <span class="font-medium">Tailwind CSS</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Ãšltima AtualizaÃ§Ã£o:</span>
            <span class="font-medium">Dezembro 2024</span>
          </div>
        </div>
      </div>
      
      <!-- AÃ§Ãµes do Sistema -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-bold text-litte-dark mb-4">âš™ï¸ AÃ§Ãµes do Sistema</h3>
        <div class="space-y-3">
          
          <button onclick="sincronizarTudo()" class="w-full btn-primary px-4 py-3 rounded-lg text-left flex items-center gap-3">
            <span>ğŸ”„</span>
            <div>
              <p class="font-medium">Sincronizar Tudo</p>
              <p class="text-xs opacity-80">Atualiza todas as abas e integraÃ§Ãµes</p>
            </div>
          </button>
          
          <button onclick="executarSetupCompleto()" class="w-full btn-secondary px-4 py-3 rounded-lg text-left flex items-center gap-3">
            <span>ğŸ› ï¸</span>
            <div>
              <p class="font-medium">Setup Completo</p>
              <p class="text-xs opacity-80">Cria todas as abas necessÃ¡rias</p>
            </div>
          </button>
          
          <button onclick="verificarPrazos()" class="w-full btn-secondary px-4 py-3 rounded-lg text-left flex items-center gap-3">
            <span>â°</span>
            <div>
              <p class="font-medium">Verificar Prazos</p>
              <p class="text-xs opacity-80">Analisa prazos vencidos e prÃ³ximos</p>
            </div>
          </button>
          
        </div>
      </div>
      
      <!-- EstatÃ­sticas -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-bold text-litte-dark mb-4">ğŸ“Š EstatÃ­sticas</h3>
        <div id="stats-container" class="space-y-3">
          <p class="text-center text-gray-500">Carregando...</p>
        </div>
      </div>
      
    </div>
  `;
  
  document.getElementById('view-content').innerHTML = html;
  
  // Carregar estatÃ­sticas
  carregarEstatisticas();
}

function carregarEstatisticas() {
  google.script.run
    .withSuccessHandler(function(result) {
      if (result.success) {
        document.getElementById('stats-container').innerHTML = `
          <div class="flex justify-between">
            <span class="text-gray-600">Total Assessorados:</span>
            <span class="font-bold text-litte-dark">${result.totalAssessorados}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Campanhas Ativas:</span>
            <span class="font-bold text-litte-dark">${result.campanhasAtivas}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">ProspecÃ§Ãµes:</span>
            <span class="font-bold text-litte-dark">${result.prospeccoes}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Taxa ConversÃ£o:</span>
            <span class="font-bold text-litte-green">${result.taxaConversao}%</span>
          </div>
        `;
      }
    })
    .withFailureHandler(function(error) {
      document.getElementById('stats-container').innerHTML = `
        <p class="text-center text-red-500">Erro ao carregar estatÃ­sticas</p>
      `;
    })
    .getDashboardData();
}

function sincronizarTudo() {
  showLoading('Sincronizando tudo...');
  
  Promise.all([
    new Promise((resolve) => google.script.run.withSuccessHandler(resolve).sincronizarCampanhasAtivas()),
    new Promise((resolve) => google.script.run.withSuccessHandler(resolve).sincronizarFinanceiroMaster()),
    new Promise((resolve) => google.script.run.withSuccessHandler(resolve).sincronizarControleRepasses())
  ]).then(() => {
    hideLoading();
    showToast('âœ… SincronizaÃ§Ã£o completa!', 'success');
  }).catch(() => {
    hideLoading();
    showToast('âŒ Erro na sincronizaÃ§Ã£o', 'error');
  });
}

function executarSetupCompleto() {
  showLoading('Executando setup...');
  
  google.script.run
    .withSuccessHandler(function(result) {
      hideLoading();
      if (result.success) {
        showToast('âœ… Setup completo executado!', 'success');
      } else {
        showToast('âŒ Erro no setup', 'error');
      }
    })
    .withFailureHandler(function(error) {
      hideLoading();
      showToast('âŒ Erro no setup', 'error');
    })
    .setupSheets();
}

function verificarPrazos() {
  showLoading('Verificando prazos...');
  
  google.script.run
    .withSuccessHandler(function(result) {
      hideLoading();
      if (result.success) {
        showToast('âœ… ' + result.count + ' prazos verificados', 'success');
      }
    })
    .withFailureHandler(function(error) {
      hideLoading();
      showToast('âŒ Erro ao verificar prazos', 'error');
    })
    .verificarPrazosVencidos();
}

function testarIntegracoes() {
  showLoading('Testando integraÃ§Ãµes...');
  
  google.script.run
    .withSuccessHandler(function(result) {
      hideLoading();
      if (result.success) {
        showToast('âœ… Todas as integraÃ§Ãµes OK!', 'success');
        console.log('Resultado do teste:', result);
      } else {
        showToast('âŒ Erro nos testes: ' + result.message, 'error');
      }
    })
    .withFailureHandler(function(error) {
      hideLoading();
      showToast('âŒ Erro ao testar', 'error');
      console.error(error);
    })
    .testarIntegracoes();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                    MODAL: EDITAR ASSESSORADO (COMPLETO)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function editarAssessorado(assessorado) {
  const modalHTML = `
    <div id="modal-editar-assessorado" class="fixed inset-0 modal-backdrop flex items-center justify-center z-40 fade-in">
      <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto m-4">
        
        <!-- Header -->
        <div class="bg-litte-dark text-white px-6 py-4 flex items-center justify-between sticky top-0 z-10">
          <h3 class="text-xl font-bold">âœï¸ Editar Assessorado</h3>
          <button onclick="closeModal('modal-editar-assessorado')" class="text-2xl hover:text-litte-cream">&times;</button>
        </div>
        
        <!-- Body -->
        <div class="p-6">
          <form id="form-editar-assessorado" onsubmit="salvarEdicaoAssessorado(event)">
            <input type="hidden" name="id" value="${assessorado.id}">
            
            <!-- InformaÃ§Ãµes BÃ¡sicas -->
            <h4 class="text-lg font-bold text-litte-dark mb-4">ğŸ“ InformaÃ§Ãµes BÃ¡sicas</h4>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
              <div>
                <label class="block text-sm font-medium mb-2">Nome Completo *</label>
                <input type="text" name="nome" value="${assessorado.nome}" required 
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-2">UsuÃ¡rio (@) *</label>
                <input type="text" name="usuario" value="${assessorado.usuario}" required 
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
              <div>
                <label class="block text-sm font-medium mb-2">Email</label>
                <input type="email" name="email" value="${assessorado.email || ''}"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-2">Telefone</label>
                <input type="tel" name="telefone" value="${assessorado.telefone || ''}"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-2">Idade</label>
                <input type="number" name="idade" value="${assessorado.idade || ''}"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
            </div>
            
            <!-- Tamanhos -->
            <h4 class="text-lg font-bold text-litte-dark mb-4 mt-6">ğŸ‘• Tamanhos</h4>
            
            <div class="grid grid-cols-3 gap-4 mb-6">
              <div>
                <label class="block text-sm font-medium mb-2">Sapato</label>
                <input type="text" name="sapato" value="${assessorado.sapato || ''}"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-2">Camiseta</label>
                <input type="text" name="camiseta" value="${assessorado.camiseta || ''}"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-2">CalÃ§a</label>
                <input type="text" name="calca" value="${assessorado.calca || ''}"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
            </div>
            
            <!-- EndereÃ§o -->
            <h4 class="text-lg font-bold text-litte-dark mb-4 mt-6">ğŸ“ EndereÃ§o</h4>
            
            <div class="mb-4">
              <label class="block text-sm font-medium mb-2">Nome do EndereÃ§o</label>
              <input type="text" name="enderecoNome" value="${assessorado.enderecoNome || ''}"
                class="w-full px-4 py-2 border rounded-lg" placeholder="Ex: Casa, Trabalho...">
            </div>
            
            <div class="grid grid-cols-3 gap-4 mb-4">
              <div class="col-span-2">
                <label class="block text-sm font-medium mb-2">Rua</label>
                <input type="text" name="rua" value="${assessorado.rua || ''}"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-2">NÃºmero</label>
                <input type="text" name="numero" value="${assessorado.numero || ''}"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium mb-2">Complemento</label>
                <input type="text" name="complemento" value="${assessorado.complemento || ''}"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-2">Bairro</label>
                <input type="text" name="bairro" value="${assessorado.bairro || ''}"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
            </div>
            
            <div class="grid grid-cols-3 gap-4 mb-6">
              <div>
                <label class="block text-sm font-medium mb-2">Cidade</label>
                <input type="text" name="cidade" value="${assessorado.cidade || ''}"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-2">Estado</label>
                <input type="text" name="estado" value="${assessorado.estado || ''}"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-2">CEP</label>
                <input type="text" name="cep" value="${assessorado.cep || ''}"
                  class="w-full px-4 py-2 border rounded-lg">
              </div>
            </div>
            
            <!-- ObservaÃ§Ãµes -->
            <div class="mb-6">
              <label class="block text-sm font-medium mb-2">ObservaÃ§Ãµes</label>
              <textarea name="observacoes" rows="3" class="w-full px-4 py-2 border rounded-lg">${assessorado.observacoes || ''}</textarea>
            </div>
            
            <!-- BotÃµes -->
            <div class="flex gap-2 justify-end pt-4 border-t">
              <button type="button" onclick="closeModal('modal-editar-assessorado')" 
                class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                Cancelar
              </button>
              <button type="submit" 
                class="btn-primary px-6 py-2 rounded-lg flex items-center gap-2">
                <span id="btn-edit-spinner" class="hidden">
                  <div class="spinner"></div>
                </span>
                <span id="btn-edit-text">ğŸ’¾ Salvar AlteraÃ§Ãµes</span>
              </button>
            </div>
            
          </form>
        </div>
        
      </div>
    </div>
  `;
  
  document.getElementById('modals-container').innerHTML = modalHTML;
}

function salvarEdicaoAssessorado(event) {
  event.preventDefault();
  
  const form = event.target;
  const formData = new FormData(form);
  
  const dados = {
    id: formData.get('id'),
    nome: formData.get('nome'),
    usuario: formData.get('usuario'),
    email: formData.get('email'),
    telefone: formData.get('telefone'),
    idade: formData.get('idade'),
    sapato: formData.get('sapato'),
    camiseta: formData.get('camiseta'),
    calca: formData.get('calca'),
    enderecoNome: formData.get('enderecoNome'),
    rua: formData.get('rua'),
    numero: formData.get('numero'),
    complemento: formData.get('complemento'),
    bairro: formData.get('bairro'),
    cidade: formData.get('cidade'),
    estado: formData.get('estado'),
    cep: formData.get('cep'),
    observacoes: formData.get('observacoes')
  };
  
  // Mostrar loading
  document.getElementById('btn-edit-spinner').classList.remove('hidden');
  document.getElementById('btn-edit-text').textContent = 'Salvando...';
  form.querySelectorAll('button').forEach(btn => btn.disabled = true);
  
  google.script.run
    .withSuccessHandler(function(result) {
      form.querySelectorAll('button').forEach(btn => btn.disabled = false);
      document.getElementById('btn-edit-spinner').classList.add('hidden');
      document.getElementById('btn-edit-text').textContent = 'ğŸ’¾ Salvar AlteraÃ§Ãµes';
      
      if (result.success) {
        closeModal('modal-editar-assessorado');
        showToast('âœ… Assessorado atualizado!', 'success');
        
        // Recarregar
        cachedData.assessorados = null;
        setTimeout(function() {
          if (currentView === 'assessorados') {
            renderAssessorados();
          }
        }, 500);
      } else {
        showToast('âŒ Erro: ' + result.message, 'error');
      }
    })
    .withFailureHandler(function(error) {
      form.querySelectorAll('button').forEach(btn => btn.disabled = false);
      document.getElementById('btn-edit-spinner').classList.add('hidden');
      document.getElementById('btn-edit-text').textContent = 'ğŸ’¾ Salvar AlteraÃ§Ãµes';
      showToast('âŒ Erro ao salvar', 'error');
      console.error(error);
    })
    .atualizarAssessorado(dados);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//                    1. VER DETALHES ASSESSORADO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function verDetalhesAssessorado(idAssessorado) {
  console.log('ğŸ‘ï¸ Carregando detalhes do assessorado:', idAssessorado);
  
  showLoading('Carregando informaÃ§Ãµes...');
  
  google.script.run
    .withSuccessHandler(function(assessorado) {
      hideLoading();
      
      if (assessorado) {
        renderModalDetalhesAssessorado(assessorado);
      } else {
        showToast('âŒ Assessorado nÃ£o encontrado', 'error');
      }
    })
    .withFailureHandler(function(error) {
      hideLoading();
      showToast('âŒ Erro ao carregar dados', 'error');
      console.error(error);
    })
    .getAssessorado(idAssessorado);
}

function renderModalDetalhesAssessorado(assessorado) {
  const modalHTML = `
    <div id="modal-detalhes-assessorado" class="fixed inset-0 modal-backdrop flex items-center justify-center z-40 fade-in">
      <div class="bg-white rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] overflow-y-auto m-4">
        
        <!-- Header -->
        <div class="bg-gradient-to-r from-litte-dark to-litte-green text-white px-6 py-4 flex items-center justify-between sticky top-0 z-10 shadow-lg">
          <div>
            <h3 class="text-xl font-bold">ğŸ‘¤ Perfil do Influenciador</h3>
            <p class="text-sm text-litte-cream">${assessorado.nome} (@${assessorado.usuario})</p>
          </div>
          <button onclick="closeModal('modal-detalhes-assessorado')" class="text-2xl hover:text-litte-cream hover:rotate-90 transition-transform">&times;</button>
        </div>
        
        <!-- Body -->
        <div class="p-6">
          
          <!-- Card Principal -->
          <div class="bg-gradient-to-r from-litte-dark to-litte-green text-white rounded-lg p-6 mb-6 shadow-lg">
            <div class="flex items-center gap-6">
              <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center text-4xl font-bold text-litte-dark">
                ${assessorado.nome.charAt(0).toUpperCase()}
              </div>
              <div class="flex-1">
                <h2 class="text-3xl font-bold mb-2">${assessorado.nome}</h2>
                <div class="flex items-center gap-4 text-litte-cream">
                  <span class="flex items-center gap-2">
                    <span>ğŸ“±</span>
                    <span>@${assessorado.usuario}</span>
                  </span>
                  <span class="flex items-center gap-2">
                    <span>ğŸ†”</span>
                    <span>${assessorado.id}</span>
                  </span>
                  <span class="px-3 py-1 ${assessorado.status === 'Ativo' ? 'bg-green-500' : 'bg-red-500'} rounded-full text-sm">
                    ${assessorado.status === 'Ativo' ? 'âœ…' : 'âŒ'} ${assessorado.status}
                  </span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Grid de InformaÃ§Ãµes -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            
            <!-- Contato -->
            <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6">
              <h4 class="text-lg font-bold text-litte-dark mb-4 flex items-center gap-2">
                <span>ğŸ“§</span>
                <span>InformaÃ§Ãµes de Contato</span>
              </h4>
              <div class="space-y-3">
                <div class="bg-white p-3 rounded border">
                  <p class="text-xs text-gray-500 mb-1">Email</p>
                  <p class="font-medium">${assessorado.email || '--'}</p>
                </div>
                <div class="bg-white p-3 rounded border">
                  <p class="text-xs text-gray-500 mb-1">Telefone</p>
                  <p class="font-medium">${assessorado.telefone || '--'}</p>
                </div>
                <div class="bg-white p-3 rounded border">
                  <p class="text-xs text-gray-500 mb-1">Idade</p>
                  <p class="font-medium">${assessorado.idade || '--'} anos</p>
                </div>
              </div>
            </div>
            
            <!-- Medidas -->
            <div class="bg-purple-50 border-2 border-purple-200 rounded-lg p-6">
              <h4 class="text-lg font-bold text-litte-dark mb-4 flex items-center gap-2">
                <span>ğŸ‘•</span>
                <span>Medidas e Tamanhos</span>
              </h4>
              <div class="space-y-3">
                <div class="bg-white p-3 rounded border">
                  <p class="text-xs text-gray-500 mb-1">Camiseta</p>
                  <p class="font-medium">${assessorado.camiseta || '--'}</p>
                </div>
                <div class="bg-white p-3 rounded border">
                  <p class="text-xs text-gray-500 mb-1">CalÃ§a</p>
                  <p class="font-medium">${assessorado.calca || '--'}</p>
                </div>
                <div class="bg-white p-3 rounded border">
                  <p class="text-xs text-gray-500 mb-1">Sapato</p>
                  <p class="font-medium">${assessorado.sapato || '--'}</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- EndereÃ§o Completo -->
          ${assessorado.rua || assessorado.cidade ? `
          <div class="bg-green-50 border-2 border-green-200 rounded-lg p-6 mb-6">
            <h4 class="text-lg font-bold text-litte-dark mb-4 flex items-center gap-2">
              <span>ğŸ“</span>
              <span>EndereÃ§o de Entrega</span>
            </h4>
            <div class="bg-white p-4 rounded border space-y-2">
              ${assessorado.enderecoNome ? `<p class="font-bold text-lg">${assessorado.enderecoNome}</p>` : ''}
              <p>${assessorado.rua || '--'}, ${assessorado.numero || 's/n'}</p>
              ${assessorado.complemento ? `<p class="text-sm text-gray-600">Complemento: ${assessorado.complemento}</p>` : ''}
              <p>${assessorado.bairro || '--'} - ${assessorado.cidade || '--'}/${assessorado.estado || '--'}</p>
              <p class="font-medium">CEP: ${assessorado.cep || '--'}</p>
            </div>
          </div>
          ` : ''}
          
          <!-- ObservaÃ§Ãµes -->
          ${assessorado.observacoes ? `
          <div class="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-6 mb-6">
            <h4 class="text-lg font-bold text-litte-dark mb-4 flex items-center gap-2">
              <span>ğŸ“</span>
              <span>ObservaÃ§Ãµes</span>
            </h4>
            <p class="text-gray-800 bg-white p-4 rounded border">${assessorado.observacoes}</p>
          </div>
          ` : ''}
          
          <!-- Links e Datas -->
          <div class="bg-gray-50 border-2 border-gray-200 rounded-lg p-6 mb-6">
            <h4 class="text-lg font-bold text-litte-dark mb-4 flex items-center gap-2">
              <span>ğŸ”—</span>
              <span>Links e InformaÃ§Ãµes do Sistema</span>
            </h4>
            <div class="space-y-3">
              ${assessorado.urlPastaDrive ? `
              <div class="bg-white p-3 rounded border">
                <p class="text-xs text-gray-500 mb-2">Pasta no Drive</p>
                <a href="${assessorado.urlPastaDrive}" target="_blank" 
                  class="text-litte-dark hover:text-litte-green underline font-medium flex items-center gap-2">
                  <span>ğŸ“</span>
                  <span>Abrir Pasta do Drive</span>
                </a>
              </div>
              ` : ''}
              
              ${assessorado.linkPlanilhaEspelho ? `
              <div class="bg-white p-3 rounded border">
                <p class="text-xs text-gray-500 mb-2">Planilha Espelho</p>
                <a href="${assessorado.linkPlanilhaEspelho}" target="_blank" 
                  class="text-litte-dark hover:text-litte-green underline font-medium flex items-center gap-2">
                  <span>ğŸ“Š</span>
                  <span>Abrir Planilha Espelho</span>
                </a>
              </div>
              ` : ''}
              
              <div class="bg-white p-3 rounded border grid grid-cols-2 gap-4">
                <div>
                  <p class="text-xs text-gray-500 mb-1">Data de Cadastro</p>
                  <p class="font-medium">${assessorado.dataCadastro || '--'}</p>
                </div>
                <div>
                  <p class="text-xs text-gray-500 mb-1">Status</p>
                  <p class="font-bold ${assessorado.status === 'Ativo' ? 'text-green-600' : 'text-red-600'}">
                    ${assessorado.status === 'Ativo' ? 'âœ…' : 'âŒ'} ${assessorado.status}
                  </p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- BotÃµes de AÃ§Ã£o -->
          <div class="flex gap-2 justify-end pt-4 border-t-2 border-gray-200">
            <button onclick="closeModal('modal-detalhes-assessorado')" 
              class="px-6 py-2 border-2 border-gray-300 rounded-lg hover:bg-gray-50 font-medium transition">
              Fechar
            </button>
            <button onclick="closeModal('modal-detalhes-assessorado'); editarAssessorado('${assessorado.id}')" 
              class="btn-primary px-6 py-2 rounded-lg flex items-center gap-2 font-medium">
              <span>âœï¸</span>
              <span>Editar Assessorado</span>
            </button>
          </div>
          
        </div>
        
      </div>
    </div>
  `;
  
  document.getElementById('modals-container').innerHTML = modalHTML;
}
   
  </script>

</body>
</html>
